<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title></title>
<style type="text/css">
.ansi2html-content { display: inline; white-space: pre-wrap; word-wrap: break-word; }
.body_foreground { color: #AAAAAA; }
.body_background { background-color: #000000; }
.body_foreground > .bold,.bold > .body_foreground, body.body_foreground > pre > .bold { color: #FFFFFF; font-weight: normal; }
.inv_foreground { color: #000000; }
.inv_background { background-color: #AAAAAA; }
.ansi1 { font-weight: bold; }
.ansi31 { color: #aa0000; }
.ansi32 { color: #00aa00; }
.ansi33 { color: #aa5500; }
.ansi34 { color: #0000aa; }
.ansi93 { color: #ea9540; }
</style>
</head>
<body class="body_foreground body_background" style="font-size: 80%;" >
<pre class="ansi2html-content">

<span class="ansi34"></span><span class="ansi1 ansi34">&lt;&lt;&lt; Starting walkthrough tests of encapsia-cli &gt;&gt;&gt;</span>
These are *not* self-verifying tests, so check the output for reasonableness!

<span class="ansi93"></span><span class="ansi1 ansi93">=== Print out overall help ===</span>
&gt;encapsia help
<span class="ansi33">Usage: encapsia help [OPTIONS] COMMAND [ARGS]...

  CLI to talk to an encapsia host.

  The following steps are used to determine the server URL and token:

    If provided, use the --host option to reference an entry in ~/.encapsia/credentials.toml
    Else if set, use ENCAPSIA_HOST to reference an entry in ~/.encapsia/credentials.toml
    Else if set, use ENCAPSIA_URL and ENCAPSIA_TOKEN directly.
    Else abort.

  The tool will also abort if instructed to lookup in
  ~/.encapsia/credentials.toml but cannot find a correct entry.

Options:
  --help  Show this message and exit.

Commands:
  config    Get/set server configuration.
  database  Backups and Restore encapsia databases.
  fixtures  Manage database fixtures.
  help      Print longer help information about the CLI.
  httpie    Helper to use httpie with the URL and credentials passed in.
  plugins   Install, uninstall, create, and update plugins.
  run       Run an Encapsia task, job, or view.
  schedule  Manage task schedules.
  shell     Start an interactive shell for running the encapsia commands.
  token     Do things with an encapsia token.
  users     Manage users, including superuser and system users.
  version   Print version information about the CLI.</span>
<span class="ansi33"></span>
<span class="ansi33">Subcommands:</span>
<span class="ansi33">  config delete                       Delete value against given key.</span>
<span class="ansi33">  config get                          Retrieve value against given key.</span>
<span class="ansi33">  config load                         Load (merge) configuration from given file.</span>
<span class="ansi33">  config save                         Save entire configuration to given file.</span>
<span class="ansi33">  config set                          Store value against given key.</span>
<span class="ansi33">  config show                         Show entire configuration.</span>
<span class="ansi33">  database backup                     Backup database to given filename.</span>
<span class="ansi33">  database restore                    Restore database from given backup file.</span>
<span class="ansi33">  fixtures create                     Create new fixture with given name.</span>
<span class="ansi33">  fixtures delete                     Delete fixture with given name.</span>
<span class="ansi33">  fixtures list                       List available fixtures.</span>
<span class="ansi33">  fixtures use                        Switch to fixture with given name.</span>
<span class="ansi33">  httpie shell                        Launch an httpie interactive shell with...</span>
<span class="ansi33">  plugins build-from-legacy-s3        Build plugins from legacy webapps hosted on...</span>
<span class="ansi33">  plugins build-from-src              Build plugins from given source directories.</span>
<span class="ansi33">  plugins dev-create-namespace        Create namespace of given name.</span>
<span class="ansi33">  plugins dev-destroy-namespace       Destroy namespace of given name.</span>
<span class="ansi33">  plugins dev-list-namespaces         Provide some information about the namespace...</span>
<span class="ansi33">  plugins dev-update                  Update plugin parts which have changed since...</span>
<span class="ansi33">  plugins fetch-from-url              Copy a plugin from given URL into the plugin...</span>
<span class="ansi33">  plugins info                        Provide information about installed plugins.</span>
<span class="ansi33">  plugins install                     Install plugins from files and/or an optional...</span>
<span class="ansi33">  plugins uninstall                   Uninstall named plugin.</span>
<span class="ansi33">  run job                             Run a job in given plugin NAMESPACE and...</span>
<span class="ansi33">  run task                            Run a task in given plugin NAMESPACE and...</span>
<span class="ansi33">  run view                            Run a view in given plugin NAMESPACE and...</span>
<span class="ansi33">  schedule add                        Add new scheduled task.</span>
<span class="ansi33">  schedule list                       List all scheduled tasks.</span>
<span class="ansi33">  schedule remove-task                Remove scheduled task by id.</span>
<span class="ansi33">  schedule remove-tasks-in-namespace  Remove all scheduled tasks in given...</span>
<span class="ansi33">  token expire                        Expire token from server, and update encapsia...</span>
<span class="ansi33">  token extend                        Extend the lifespan of token and update...</span>
<span class="ansi33">  token whoami                        Print information about current owner of...</span>
<span class="ansi33">  users add-superuser                 Create superuser with suitable user and role.</span>
<span class="ansi33">  users add-systemuser                Create system user with suitable user and...</span>
<span class="ansi33">  users delete                        Delete user (but *do not* delete any related...</span>
<span class="ansi33">  users export                        Export users (and roles) to given TOML file.</span>
<span class="ansi33">  users import                        Import users (and roles) from given TOML...</span>
<span class="ansi33">  users list                          List out information about users.</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Print out help on help ===</span>
&gt;encapsia help help
<span class="ansi33">Usage: encapsia help [OPTIONS] [COMMAND]

  Print longer help information about the CLI.

Options:
  --colour [always|never|auto]  Control colour on stdout.
  --help                        Show this message and exit.</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Print out help on users ===</span>
&gt;encapsia help users
<span class="ansi33">Usage: encapsia help [OPTIONS] COMMAND [ARGS]...

  Manage users, including superuser and system users.

Options:
  --colour [always|never|auto]  Control colour on stdout.
  --host TEXT                   Name to use to lookup credentials in
                                .encapsia/credentials.toml

  --help                        Show this message and exit.

Commands:
  add-superuser   Create superuser with suitable user and role.
  add-systemuser  Create system user with suitable user and role.
  delete          Delete user (but *do not* delete any related role).
  export          Export users (and roles) to given TOML file.
  import          Import users (and roles) from given TOML file.
  list            List out information about users.</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Print out the version ===</span>
&gt;encapsia version
<span class="ansi33">Encapsia CLI version: 0.1.16</span>
<span class="ansi33">Encapsia API version: 0.1.22</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Get whoami info about current token ===</span>
&gt;encapsia token whoami
<span class="ansi32">id = 91
name = "Root Superuser"
email = "system@root.encapsia.com"
capabilities = [ "superuser",]
expires_at = "2021-03-10T16:06:56.568357+00:00"
issued_at = "2020-03-10T16:06:56.568357+00:00"
site_id = ""
token = "9a4fa2d5ccd04080ad031618405852cd"
</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Extend lifespan of token (changes the encapsia credentials) ===</span>
&gt;encapsia token extend
<span class="ansi33">Encapsia credentials file updated.</span>
&gt;encapsia token whoami
<span class="ansi32">id = 95
name = "Root Superuser"
email = "system@root.encapsia.com"
capabilities = [ "superuser",]
expires_at = "2021-03-10T16:31:18.118559+00:00"
issued_at = "2020-03-10T16:31:18.118559+00:00"
site_id = ""
token = "eeab0effbb6b484ba4d9b6b9b1f1cddc"
</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Set a config value to a string ===</span>
&gt;encapsia config set test_string \"a_string\"
&gt;encapsia config get test_string
<span class="ansi32">"a_string"</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Set a config value to a number ===</span>
&gt;encapsia config set test_number 123
&gt;encapsia config get test_number
<span class="ansi32">123</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Set a config value to a list ===</span>
&gt;encapsia config set test_list '["a", 1]'
&gt;encapsia config get test_list
<span class="ansi32">[
    "a",
    1
]</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Delete config values ===</span>
&gt;encapsia config delete test_string
&gt;encapsia config delete test_number
&gt;encapsia config delete test_list

<span class="ansi93"></span><span class="ansi1 ansi93">=== Save config to a file and load it again ===</span>
&gt;encapsia config save /tmp/test_encapsia_config.json
&gt;cat /tmp/test_encapsia_config.json
{
    "blob_lifespan": 3600,
    "blob_path": "/v1/blobs/{id}",
    "coding": {
        "coding_server": "https://to.coding.server"
    },
    "firebase": {
        "profiles": {
            "chat": {
                "secret": "Kpforr0KblWZddZe70q9dTvEe1c34hfKaPdvXmVX",
                "url": "https://glaring-inferno-5677.firebaseio.com"
            },
            "tutor": {
                "secret": "Kpforr0KblWZddZe70q9dTvEe1c34hfKaPdvXmVX",
                "url": "https://glaring-inferno-5677.firebaseio.com/activitydata/"
            }
        }
    },
    "graph_tenant_id": "cmedtechnology.com",
    "html2pdf": {
        "conversionUrl": "https://SHpO3zw1zlHLpsOyY4@docraptor.com/docs",
        "statusUrl": "https://SHpO3zw1zlHLpsOyY4@docraptor.com/status",
        "test": true
    },
    "job_timeout": 3600,
    "node": "analytics1",
    "oauth2_azure": {
        "additional_auth_parameters": {
            "sign": "sign"
        },
        "auth_uri": "https://login.windows.net/2a0d4e61-e0c9-4e26-a615-5c7ff13ea03b/oauth2/authorize?api-version=1.0&amp;prompt=login",
        "client_id": "889c979a-939e-47ad-b595-1ac1525a7162",
        "client_secret": "sLI86aqMw+mnGeSCmpaWP/IFqwyr0h4jg95A6uGZ3cc=",
        "email_jwt_key": "unique_name",
        "scope": "openid email",
        "token_uri": "https://login.windows.net/2a0d4e61-e0c9-4e26-a615-5c7ff13ea03b/oauth2/token"
    },
    "oauth2_google": {
        "additional_auth_parameters": {
            "prefill_email": "login_hint"
        },
        "auth_uri": "https://accounts.google.com/o/oauth2/auth?max_auth_age=0",
        "client_id": "728530777116.apps.googleusercontent.com",
        "client_secret": "8OnW6IYHPMKi6O9TfFXhc7zi",
        "scope": "openid email",
        "token_uri": "https://accounts.google.com/o/oauth2/token"
    },
    "oauth2_providers": [
        "google",
        "azure"
    ],
    "oauth2_reply_html": "&lt;!DOCTYPE html&gt;\n&lt;html lang='en'&gt;\n  &lt;head&gt;\n    &lt;meta charset=\"utf-8\"&gt;\n    &lt;title&gt;ICE login&lt;/title&gt;\n    &lt;script&gt;\n    var isLoginSuccess = false;\n    try {\n        if (typeof opener.handleLoginSuccess != 'undefined') {\n            opener.handleLoginSuccess(\n                '{{status|e}}:{{data|e}}', '{{return_url|e}}');\n            isLoginSuccess = true;\n        }\n    } catch (err) {\n        console.log('CORS error usually when using icewebautologin');\n    }\n    if (!isLoginSuccess) {\n        opener.postMessage('{{status|e}}:{{data|e}}', '{{return_url|e}}');\n    }\n    window.close();\n    &lt;/script&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;input type=\"hidden\" name=\"hiddenStatus\" value='{{status|e}}'&gt;\n    &lt;input type=\"hidden\" name=\"hiddenData\" value='{{data|e}}'&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n",
    "root_token": "&lt;hidden&gt;",
    "session_lifespan": 604800,
    "task_timeout": 600,
    "tmp_maintenance": {
        "cleanout_interval": 72
    },
    "trial": "analytics1",
    "url": "https://analytics1.icethree.com",
    "view_lifespan": 600
}&gt;cat /tmp/test_encapsia_config.json
&gt;python -c "import json, sys; c=json.load(sys.stdin); del c['root_token']; print(json.dumps(c))" &gt; /tmp/test_encapsia_config2.json
&gt;encapsia config load /tmp/test_encapsia_config2.json
&gt;rm /tmp/test_encapsia_config*.json

<span class="ansi93"></span><span class="ansi1 ansi93">=== Show the entire config ===</span>
&gt;encapsia config show
<span class="ansi32">{
    "blob_lifespan": 3600,
    "blob_path": "/v1/blobs/{id}",
    "coding": {
        "coding_server": "https://to.coding.server"
    },
    "firebase": {
        "profiles": {
            "chat": {
                "secret": "Kpforr0KblWZddZe70q9dTvEe1c34hfKaPdvXmVX",
                "url": "https://glaring-inferno-5677.firebaseio.com"
            },
            "tutor": {
                "secret": "Kpforr0KblWZddZe70q9dTvEe1c34hfKaPdvXmVX",
                "url": "https://glaring-inferno-5677.firebaseio.com/activitydata/"
            }
        }
    },
    "graph_tenant_id": "cmedtechnology.com",
    "html2pdf": {
        "conversionUrl": "https://SHpO3zw1zlHLpsOyY4@docraptor.com/docs",
        "statusUrl": "https://SHpO3zw1zlHLpsOyY4@docraptor.com/status",
        "test": true
    },
    "job_timeout": 3600,
    "node": "analytics1",
    "oauth2_azure": {
        "additional_auth_parameters": {
            "sign": "sign"
        },
        "auth_uri": "https://login.windows.net/2a0d4e61-e0c9-4e26-a615-5c7ff13ea03b/oauth2/authorize?api-version=1.0&amp;prompt=login",
        "client_id": "889c979a-939e-47ad-b595-1ac1525a7162",
        "client_secret": "sLI86aqMw+mnGeSCmpaWP/IFqwyr0h4jg95A6uGZ3cc=",
        "email_jwt_key": "unique_name",
        "scope": "openid email",
        "token_uri": "https://login.windows.net/2a0d4e61-e0c9-4e26-a615-5c7ff13ea03b/oauth2/token"
    },
    "oauth2_google": {
        "additional_auth_parameters": {
            "prefill_email": "login_hint"
        },
        "auth_uri": "https://accounts.google.com/o/oauth2/auth?max_auth_age=0",
        "client_id": "728530777116.apps.googleusercontent.com",
        "client_secret": "8OnW6IYHPMKi6O9TfFXhc7zi",
        "scope": "openid email",
        "token_uri": "https://accounts.google.com/o/oauth2/token"
    },
    "oauth2_providers": [
        "google",
        "azure"
    ],
    "oauth2_reply_html": "&lt;!DOCTYPE html&gt;\n&lt;html lang='en'&gt;\n  &lt;head&gt;\n    &lt;meta charset=\"utf-8\"&gt;\n    &lt;title&gt;ICE login&lt;/title&gt;\n    &lt;script&gt;\n    var isLoginSuccess = false;\n    try {\n        if (typeof opener.handleLoginSuccess != 'undefined') {\n            opener.handleLoginSuccess(\n                '{{status|e}}:{{data|e}}', '{{return_url|e}}');\n            isLoginSuccess = true;\n        }\n    } catch (err) {\n        console.log('CORS error usually when using icewebautologin');\n    }\n    if (!isLoginSuccess) {\n        opener.postMessage('{{status|e}}:{{data|e}}', '{{return_url|e}}');\n    }\n    window.close();\n    &lt;/script&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;input type=\"hidden\" name=\"hiddenStatus\" value='{{status|e}}'&gt;\n    &lt;input type=\"hidden\" name=\"hiddenData\" value='{{data|e}}'&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n",
    "root_token": "&lt;hidden&gt;",
    "session_lifespan": 604800,
    "task_timeout": 600,
    "tmp_maintenance": {
        "cleanout_interval": 72
    },
    "trial": "analytics1",
    "url": "https://analytics1.icethree.com",
    "view_lifespan": 600
}</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Build the example plugin from src ===</span>
&gt;encapsia plugins --force build-from-src $EXAMPLE_PLUGIN_SRC
<span class="ansi33">Created: /home/tcorbettclark/.encapsia/plugins-cache/plugin-example-0.0.1.tar.gz</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Request a build again, but this time it should be skipped over because it already exists in the cache ===</span>
&gt;encapsia plugins build-from-src $EXAMPLE_PLUGIN_SRC
<span class="ansi33">Found: /home/tcorbettclark/.encapsia/plugins-cache/plugin-example-0.0.1.tar.gz (Skipping)</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Move the example plugin out of the cache and then add it back in directly ===</span>
&gt;mv ~/.encapsia/plugins-cache/plugin-example-0.0.1.tar.gz /tmp/
&gt;encapsia plugins fetch-from-url file:///tmp/plugin-example-0.0.1.tar.gz
<span class="ansi33">Created: /home/tcorbettclark/.encapsia/plugins-cache/plugin-example-0.0.1.tar.gz</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Build the launch plugin from legacy S3 (after first removing from the cache) ===</span>
&gt;rm -f ~/.encapsia/plugins-cache/plugin-launch-*.tar.gz
&gt;encapsia plugins build-from-legacy-s3 --versions=s3_plugins.toml --email=test_user@encapsia.com
<span class="ansi33">Created: /home/tcorbettclark/.encapsia/plugins-cache/plugin-launch-1.2.2.tar.gz</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Second time should be skipped over because it is already in the cache ===</span>
&gt;encapsia plugins build-from-legacy-s3 --versions=s3_plugins.toml --email=test_user@encapsia.com
<span class="ansi33">Found: /home/tcorbettclark/.encapsia/plugins-cache/plugin-launch-1.2.2.tar.gz (Skipping)</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Install the example plugin from the cache, then uninstall it ===</span>
&gt;encapsia plugins install --versions=example.toml
<span class="ansi33">Uploaded /home/tcorbettclark/.encapsia/plugins-cache/plugin-example-0.0.1.tar.gz to blob: 3472490879dc469fb48e18f27012165c</span>
<span class="ansi33">Installing</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Status: ok</span>
<span class="ansi32">Downloaded blob 3472490879dc469fb48e18f27012165c to /tmp/tmp6emp0ky_
Extracted /tmp/tmp6emp0ky_ into /tmp/tmp6y6y5z9u
Registered plugin example (0.0.1) from blob 3472490879dc469fb48e18f27012165c with id a62d7127ebb24a59a26bd823a0a8110f
Destroying plugin namespace: example
Stopped all task workers for namespace: example
Destroyed virtualenv: example
Removed tasks directory: /home/ice/example
Removed webfiles directory: /var/share/nginx/iceplugins/example
Destroying views namespace example
Deleted PostgreSQL schema: example
Remove published permissions, if any
Remove published tags, if any
Removing all/any schedules from plugin namespace: example
Installing plugin example (0.0.1)
Made webfiles directory: /var/share/nginx/iceplugins/example
Installing web files in to namespace example
Installed manifest /var/share/nginx/iceplugins/example/plugin.toml
pew new -d example
Using base prefix '/home/ice/.pyenv/versions/3.6.7'
New python executable in /home/ice/.local/share/virtualenvs/example/bin/python3.6
Also creating executable in /home/ice/.local/share/virtualenvs/example/bin/python
Installing setuptools, pip, wheel...
done.
pew in example pip install redis==2.10.6 rq==0.12.0
Collecting redis==2.10.6
  Using cached redis-2.10.6-py2.py3-none-any.whl (64 kB)
Collecting rq==0.12.0
  Using cached rq-0.12.0-py2.py3-none-any.whl (54 kB)
Collecting click&gt;=5.0
  Using cached click-7.1.1-py2.py3-none-any.whl (82 kB)
Installing collected packages: redis, click, rq
Successfully installed click-7.1.1 redis-2.10.6 rq-0.12.0
Made virtualenv: example
Installing wheels in to namespace example
pew in example pip install --find-links /tmp/tmp6y6y5z9u/plugin-example-0.0.1/wheels --requirement /tmp/tmp6y6y5z9u/plugin-example-0.0.1/wheels/requirements.txt
Looking in links: /tmp/tmp6y6y5z9u/plugin-example-0.0.1/wheels
Collecting encapsia-api
  Using cached encapsia_api-0.1.22-py3-none-any.whl (11 kB)
Collecting toml&lt;0.11.0,&gt;=0.10.0
  Using cached toml-0.10.0-py2.py3-none-any.whl (25 kB)
Collecting requests[security]&lt;3.0,&gt;=2.20
  Using cached requests-2.23.0-py2.py3-none-any.whl (58 kB)
Collecting certifi&gt;=2017.4.17
  Using cached certifi-2019.11.28-py2.py3-none-any.whl (156 kB)
Collecting idna&lt;3,&gt;=2.5
  Using cached idna-2.9-py2.py3-none-any.whl (58 kB)
Collecting urllib3!=1.25.0,!=1.25.1,&lt;1.26,&gt;=1.21.1
  Using cached urllib3-1.25.8-py2.py3-none-any.whl (125 kB)
Collecting chardet&lt;4,&gt;=3.0.2
  Using cached chardet-3.0.4-py2.py3-none-any.whl (133 kB)
Collecting pyOpenSSL&gt;=0.14; extra == "security"
  Using cached pyOpenSSL-19.1.0-py2.py3-none-any.whl (53 kB)
Processing ./.cache/pip/wheels/8d/f1/0f/7a44efed707005d6df5b9823293aff1e1fbd69b1649f125a8b/cryptography-2.8-cp36-cp36m-linux_x86_64.whl
Collecting six&gt;=1.5.2
  Using cached six-1.14.0-py2.py3-none-any.whl (10 kB)
Processing ./.cache/pip/wheels/6c/6b/5c/30ce64a958139dc1f16109f1393d258aa13057d266b58cb486/cffi-1.14.0-cp36-cp36m-linux_x86_64.whl
Collecting pycparser
  Using cached pycparser-2.20-py2.py3-none-any.whl (112 kB)
Installing collected packages: toml, certifi, idna, urllib3, chardet, six, pycparser, cffi, cryptography, pyOpenSSL, requests, encapsia-api
Successfully installed certifi-2019.11.28 cffi-1.14.0 chardet-3.0.4 cryptography-2.8 encapsia-api-0.1.22 idna-2.9 pyOpenSSL-19.1.0 pycparser-2.20 requests-2.23.0 six-1.14.0 toml-0.10.0 urllib3-1.25.8
Installing tasks in to namespace example
Installed task file /home/ice/example/test_module.py
Configuring 1 task workers for namespace example
Creating views namespace example
Created PostgreSQL schema: example
Installing views in to namespace example
Installing view permissions.sql
Installing view test_views.sql
Not publishing empty tags list.
Installing schedules in to namespace example
Installed plugin with id a62d7127ebb24a59a26bd823a0a8110f</span>
&gt;encapsia plugins --force uninstall example
<span class="ansi33">Uninstalling example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Status: ok</span>
<span class="ansi32">Destroying plugin namespace: example
Stopped all task workers for namespace: example
Destroyed virtualenv: example
Removed tasks directory: /home/ice/example
Removed webfiles directory: /var/share/nginx/iceplugins/example
Destroying views namespace example
Deleted PostgreSQL schema: example
Remove published permissions, if any
Remove published tags, if any
Removing all/any schedules from plugin namespace: example</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Dev update the example plugin from scratch ===</span>
&gt;encapsia plugins --force dev-update $EXAMPLE_PLUGIN_SRC
<span class="ansi33">Including: tasks</span>
<span class="ansi33">Including: views</span>
<span class="ansi33">Including: wheels</span>
<span class="ansi33">Including: schedules</span>
<span class="ansi33">Uploading to server</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Status: ok</span>
<span class="ansi32">Extracted /tmp/ice/tmp4p5o0_hg into /tmp/tmp343k0i2o
Installing plugin example (0.0.1)
Made webfiles directory: /var/share/nginx/iceplugins/example
Installing web files in to namespace example
Installed manifest /var/share/nginx/iceplugins/example/plugin.toml
pew new -d example
Using base prefix '/home/ice/.pyenv/versions/3.6.7'
New python executable in /home/ice/.local/share/virtualenvs/example/bin/python3.6
Also creating executable in /home/ice/.local/share/virtualenvs/example/bin/python
Installing setuptools, pip, wheel...
done.
pew in example pip install redis==2.10.6 rq==0.12.0
Collecting redis==2.10.6
  Using cached redis-2.10.6-py2.py3-none-any.whl (64 kB)
Collecting rq==0.12.0
  Using cached rq-0.12.0-py2.py3-none-any.whl (54 kB)
Collecting click&gt;=5.0
  Using cached click-7.1.1-py2.py3-none-any.whl (82 kB)
Installing collected packages: redis, click, rq
Successfully installed click-7.1.1 redis-2.10.6 rq-0.12.0
Made virtualenv: example
Installing wheels in to namespace example
pew in example pip install --find-links /tmp/tmp343k0i2o/tmp74cqsz_n/wheels --requirement /tmp/tmp343k0i2o/tmp74cqsz_n/wheels/requirements.txt
Looking in links: /tmp/tmp343k0i2o/tmp74cqsz_n/wheels
Collecting encapsia-api
  Using cached encapsia_api-0.1.22-py3-none-any.whl (11 kB)
Collecting requests[security]&lt;3.0,&gt;=2.20
  Using cached requests-2.23.0-py2.py3-none-any.whl (58 kB)
Collecting toml&lt;0.11.0,&gt;=0.10.0
  Using cached toml-0.10.0-py2.py3-none-any.whl (25 kB)
Collecting chardet&lt;4,&gt;=3.0.2
  Using cached chardet-3.0.4-py2.py3-none-any.whl (133 kB)
Collecting idna&lt;3,&gt;=2.5
  Using cached idna-2.9-py2.py3-none-any.whl (58 kB)
Collecting urllib3!=1.25.0,!=1.25.1,&lt;1.26,&gt;=1.21.1
  Using cached urllib3-1.25.8-py2.py3-none-any.whl (125 kB)
Collecting certifi&gt;=2017.4.17
  Using cached certifi-2019.11.28-py2.py3-none-any.whl (156 kB)
Collecting pyOpenSSL&gt;=0.14; extra == "security"
  Using cached pyOpenSSL-19.1.0-py2.py3-none-any.whl (53 kB)
Processing ./.cache/pip/wheels/8d/f1/0f/7a44efed707005d6df5b9823293aff1e1fbd69b1649f125a8b/cryptography-2.8-cp36-cp36m-linux_x86_64.whl
Collecting six&gt;=1.5.2
  Using cached six-1.14.0-py2.py3-none-any.whl (10 kB)
Processing ./.cache/pip/wheels/6c/6b/5c/30ce64a958139dc1f16109f1393d258aa13057d266b58cb486/cffi-1.14.0-cp36-cp36m-linux_x86_64.whl
Collecting pycparser
  Using cached pycparser-2.20-py2.py3-none-any.whl (112 kB)
Installing collected packages: chardet, idna, urllib3, certifi, six, pycparser, cffi, cryptography, pyOpenSSL, requests, toml, encapsia-api
Successfully installed certifi-2019.11.28 cffi-1.14.0 chardet-3.0.4 cryptography-2.8 encapsia-api-0.1.22 idna-2.9 pyOpenSSL-19.1.0 pycparser-2.20 requests-2.23.0 six-1.14.0 toml-0.10.0 urllib3-1.25.8
Installing tasks in to namespace example
Installed task file /home/ice/example/test_module.py
Configuring 1 task workers for namespace example
Creating views namespace example
Created PostgreSQL schema: example
Installing views in to namespace example
Installing view permissions.sql
Installing view test_views.sql
Not publishing empty tags list.
Installing schedules in to namespace example</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Second time round there is nothing to do because nothing has changed ===</span>
&gt;encapsia plugins dev-update $EXAMPLE_PLUGIN_SRC
<span class="ansi33">Nothing to do.</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Modify the example plugin and update again. This time only the tasks should be updated ===</span>
&gt;touch $EXAMPLE_PLUGIN_SRC/tasks/test_new_module.py
&gt;encapsia plugins dev-update $EXAMPLE_PLUGIN_SRC
<span class="ansi33">Including: tasks</span>
<span class="ansi33">Uploading to server</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Status: ok</span>
<span class="ansi32">Extracted /tmp/ice/tmpepmdmx6b into /tmp/tmp_8vzp2_2
Installing plugin example (0.0.1)
Webfiles directory already exists: /var/share/nginx/iceplugins/example
Installing web files in to namespace example
Installed manifest /var/share/nginx/iceplugins/example/plugin.toml
Virtualenv already exists: example
Installing tasks in to namespace example
Installed task file /home/ice/example/test_new_module.py
Installed task file /home/ice/example/test_module.py
Configuring 1 task workers for namespace example
Not publishing empty tags list.</span>
&gt;rm $EXAMPLE_PLUGIN_SRC/tasks/test_new_module.py

<span class="ansi93"></span><span class="ansi1 ansi93">=== Install the non-dev version of the example plugin so we can uninstall it (to be tidy). ===</span>
&gt;encapsia plugins install --versions=example.toml
<span class="ansi33">Uploaded /home/tcorbettclark/.encapsia/plugins-cache/plugin-example-0.0.1.tar.gz to blob: 016560a7881645d0ad482ab8ff07ab9b</span>
<span class="ansi33">Installing</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Status: ok</span>
<span class="ansi32">Downloaded blob 016560a7881645d0ad482ab8ff07ab9b to /tmp/tmp_g_nchj1
Extracted /tmp/tmp_g_nchj1 into /tmp/tmp47mcidwv
Registered plugin example (0.0.1) from blob 016560a7881645d0ad482ab8ff07ab9b with id ec77c0f908e34e61a1ad00d9670bcf77
Destroying plugin namespace: example
Stopped all task workers for namespace: example
Destroyed virtualenv: example
Removed tasks directory: /home/ice/example
Removed webfiles directory: /var/share/nginx/iceplugins/example
Destroying views namespace example
Deleted PostgreSQL schema: example
Remove published permissions, if any
Remove published tags, if any
Removing all/any schedules from plugin namespace: example
Installing plugin example (0.0.1)
Made webfiles directory: /var/share/nginx/iceplugins/example
Installing web files in to namespace example
Installed manifest /var/share/nginx/iceplugins/example/plugin.toml
pew new -d example
Using base prefix '/home/ice/.pyenv/versions/3.6.7'
New python executable in /home/ice/.local/share/virtualenvs/example/bin/python3.6
Also creating executable in /home/ice/.local/share/virtualenvs/example/bin/python
Installing setuptools, pip, wheel...
done.
pew in example pip install redis==2.10.6 rq==0.12.0
Collecting redis==2.10.6
  Using cached redis-2.10.6-py2.py3-none-any.whl (64 kB)
Collecting rq==0.12.0
  Using cached rq-0.12.0-py2.py3-none-any.whl (54 kB)
Collecting click&gt;=5.0
  Using cached click-7.1.1-py2.py3-none-any.whl (82 kB)
Installing collected packages: redis, click, rq
Successfully installed click-7.1.1 redis-2.10.6 rq-0.12.0
Made virtualenv: example
Installing wheels in to namespace example
pew in example pip install --find-links /tmp/tmp47mcidwv/plugin-example-0.0.1/wheels --requirement /tmp/tmp47mcidwv/plugin-example-0.0.1/wheels/requirements.txt
Looking in links: /tmp/tmp47mcidwv/plugin-example-0.0.1/wheels
Collecting encapsia-api
  Using cached encapsia_api-0.1.22-py3-none-any.whl (11 kB)
Collecting requests[security]&lt;3.0,&gt;=2.20
  Using cached requests-2.23.0-py2.py3-none-any.whl (58 kB)
Collecting toml&lt;0.11.0,&gt;=0.10.0
  Using cached toml-0.10.0-py2.py3-none-any.whl (25 kB)
Collecting certifi&gt;=2017.4.17
  Using cached certifi-2019.11.28-py2.py3-none-any.whl (156 kB)
Collecting chardet&lt;4,&gt;=3.0.2
  Using cached chardet-3.0.4-py2.py3-none-any.whl (133 kB)
Collecting idna&lt;3,&gt;=2.5
  Using cached idna-2.9-py2.py3-none-any.whl (58 kB)
Collecting urllib3!=1.25.0,!=1.25.1,&lt;1.26,&gt;=1.21.1
  Using cached urllib3-1.25.8-py2.py3-none-any.whl (125 kB)
Processing ./.cache/pip/wheels/8d/f1/0f/7a44efed707005d6df5b9823293aff1e1fbd69b1649f125a8b/cryptography-2.8-cp36-cp36m-linux_x86_64.whl
Collecting pyOpenSSL&gt;=0.14; extra == "security"
  Using cached pyOpenSSL-19.1.0-py2.py3-none-any.whl (53 kB)
Processing ./.cache/pip/wheels/6c/6b/5c/30ce64a958139dc1f16109f1393d258aa13057d266b58cb486/cffi-1.14.0-cp36-cp36m-linux_x86_64.whl
Collecting six&gt;=1.4.1
  Using cached six-1.14.0-py2.py3-none-any.whl (10 kB)
Collecting pycparser
  Using cached pycparser-2.20-py2.py3-none-any.whl (112 kB)
Installing collected packages: certifi, chardet, idna, urllib3, pycparser, cffi, six, cryptography, pyOpenSSL, requests, toml, encapsia-api
Successfully installed certifi-2019.11.28 cffi-1.14.0 chardet-3.0.4 cryptography-2.8 encapsia-api-0.1.22 idna-2.9 pyOpenSSL-19.1.0 pycparser-2.20 requests-2.23.0 six-1.14.0 toml-0.10.0 urllib3-1.25.8
Installing tasks in to namespace example
Installed task file /home/ice/example/test_module.py
Configuring 1 task workers for namespace example
Creating views namespace example
Created PostgreSQL schema: example
Installing views in to namespace example
Installing view permissions.sql
Installing view test_views.sql
Not publishing empty tags list.
Installing schedules in to namespace example
Installed plugin with id ec77c0f908e34e61a1ad00d9670bcf77</span>
&gt;encapsia plugins --force uninstall example
<span class="ansi33">Uninstalling example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Status: ok</span>
<span class="ansi32">Destroying plugin namespace: example
Stopped all task workers for namespace: example
Destroyed virtualenv: example
Removed tasks directory: /home/ice/example
Removed webfiles directory: /var/share/nginx/iceplugins/example
Destroying views namespace example
Deleted PostgreSQL schema: example
Remove published permissions, if any
Remove published tags, if any
Removing all/any schedules from plugin namespace: example</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Create and destroy new namespace ===</span>
&gt;encapsia plugins dev-create-namespace testing123
<span class="ansi33">Creating namespace</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Status: ok</span>
<span class="ansi32">Made webfiles directory: /var/share/nginx/iceplugins/testing123
Made tasks directory: /home/ice/testing123
pew new -d testing123
Using base prefix '/home/ice/.pyenv/versions/3.6.7'
New python executable in /home/ice/.local/share/virtualenvs/testing123/bin/python3.6
Also creating executable in /home/ice/.local/share/virtualenvs/testing123/bin/python
Installing setuptools, pip, wheel...
done.
pew in testing123 pip install redis==2.10.6 rq==0.12.0
Collecting redis==2.10.6
  Using cached redis-2.10.6-py2.py3-none-any.whl (64 kB)
Collecting rq==0.12.0
  Using cached rq-0.12.0-py2.py3-none-any.whl (54 kB)
Collecting click&gt;=5.0
  Using cached click-7.1.1-py2.py3-none-any.whl (82 kB)
Installing collected packages: redis, click, rq
Successfully installed click-7.1.1 redis-2.10.6 rq-0.12.0
Made virtualenv: testing123
Configuring 1 task workers for namespace testing123
Creating views namespace testing123
Created PostgreSQL schema: testing123</span>
&gt;encapsia plugins dev-destroy-namespace testing123
<span class="ansi33">Destroying namespace</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Status: ok</span>
<span class="ansi32">Stopped all task workers for namespace: testing123
Destroyed virtualenv: testing123
Removed tasks directory: /home/ice/testing123
Removed webfiles directory: /var/share/nginx/iceplugins/testing123
Destroying views namespace testing123
Deleted PostgreSQL schema: testing123</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Get info on all plugins ===</span>
&gt;encapsia plugins info
<span class="ansi33">name             version    description                     when                              plugin_tags
---------------  ---------  ------------------------------  --------------------------------  -------------
archiver         1.4.5.18   Web Archiver Plugin             2020-02-27T14:39:41.958169+00:00
conduct          1.5.5.15   Conduct app                     2020-02-27T14:40:38.575636+00:00
entry            1.7.2.15   Entry app                       2020-02-27T14:41:24.486903+00:00
esourcetraining  1.1.1.6    eSourceTraining app             2020-02-27T14:41:57.829916+00:00
inventory        1.0.1.11   Inventory app                   2020-02-27T14:42:35.056252+00:00
launch           1.2.3.4    Launch app                      2020-02-27T14:43:11.553837+00:00
loader           1.2.4.20   Web Loader Plugin               2020-02-27T14:43:48.731606+00:00
loaderreview     1.1.5.8    Review app                      2020-02-27T14:44:29.742555+00:00
manager          1.2.5.20   Manager app                     2020-02-27T14:45:04.284776+00:00
tags             1.1.2.7    Tags app                        2020-02-27T14:45:44.630668+00:00
tutor            1.1.3.9    Tutor app                       2020-02-27T14:46:11.078459+00:00
tutorbundles     1.1.0.4    Tutorbundles library for tutor  2020-02-27T14:46:41.412912+00:00</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Create a backup ===</span>
&gt;encapsia database backup /tmp/test_encapsia_backup
<span class="ansi33">Backing up database</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Downloaded 37789538 bytes to /tmp/test_encapsia_backup</span>
&gt;ls -l /tmp/test_encapsia_backup
-rw-rw-r-- 1 tcorbettclark tcorbettclark 37789538 Mar 10 16:33 /tmp/test_encapsia_backup

<span class="ansi93"></span><span class="ansi1 ansi93">=== Restore from the backup ===</span>
&gt;encapsia database restore --yes /tmp/test_encapsia_backup
<span class="ansi33">Database restore requested.</span>
<span class="ansi33">Please verify by other means (e.g. look at the logs).</span>
&gt;sleep 5
&gt;rm /tmp/test_encapsia_backup

<span class="ansi93"></span><span class="ansi1 ansi93">=== Create a fixture ===</span>
&gt;encapsia fixtures create test_fixture
<span class="ansi33">Creating fixture test_fixture</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi32">Fixture "test_fixture" created on Tue Mar 10 16:33:44 2020</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Use a fixture ===</span>
&gt;encapsia fixtures use --yes test_fixture
<span class="ansi33">Requested change to fixture test_fixture.</span>
<span class="ansi33">Please verify by other means (e.g. look at the logs).</span>
&gt;sleep 5

<span class="ansi93"></span><span class="ansi1 ansi93">=== Delete a fixture ===</span>
&gt;encapsia fixtures delete --yes test_fixture
<span class="ansi33">Deleting fixture test_fixture</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi32">Deleted fixture: test_fixture</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== List all fixtures ===</span>
&gt;encapsia fixtures list
<span class="ansi33">Fetching list of fixtures</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi32">ANALYTICS_ready
fully_installed
initialised
ready
ready_backup
ready_backup_script</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== (Setup for running views or tasks etc) Install the example plugin from src ===</span>
&gt;encapsia plugins --force dev-update $EXAMPLE_PLUGIN_SRC
<span class="ansi33">Including: tasks</span>
<span class="ansi33">Including: views</span>
<span class="ansi33">Including: wheels</span>
<span class="ansi33">Including: schedules</span>
<span class="ansi33">Uploading to server</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Status: ok</span>
<span class="ansi32">Extracted /tmp/ice/tmp1tz0ql5_ into /tmp/tmpywfv5oo1
Installing plugin example (0.0.1)
Made webfiles directory: /var/share/nginx/iceplugins/example
Installing web files in to namespace example
Installed manifest /var/share/nginx/iceplugins/example/plugin.toml
pew new -d example
Using base prefix '/home/ice/.pyenv/versions/3.6.7'
New python executable in /home/ice/.local/share/virtualenvs/example/bin/python3.6
Also creating executable in /home/ice/.local/share/virtualenvs/example/bin/python
Installing setuptools, pip, wheel...
done.
pew in example pip install redis==2.10.6 rq==0.12.0
Collecting redis==2.10.6
  Using cached redis-2.10.6-py2.py3-none-any.whl (64 kB)
Collecting rq==0.12.0
  Using cached rq-0.12.0-py2.py3-none-any.whl (54 kB)
Collecting click&gt;=5.0
  Using cached click-7.1.1-py2.py3-none-any.whl (82 kB)
Installing collected packages: redis, click, rq
Successfully installed click-7.1.1 redis-2.10.6 rq-0.12.0
Made virtualenv: example
Installing wheels in to namespace example
pew in example pip install --find-links /tmp/tmpywfv5oo1/tmpvqlewzgg/wheels --requirement /tmp/tmpywfv5oo1/tmpvqlewzgg/wheels/requirements.txt
Looking in links: /tmp/tmpywfv5oo1/tmpvqlewzgg/wheels
Collecting encapsia-api
  Using cached encapsia_api-0.1.22-py3-none-any.whl (11 kB)
Collecting toml&lt;0.11.0,&gt;=0.10.0
  Using cached toml-0.10.0-py2.py3-none-any.whl (25 kB)
Collecting requests[security]&lt;3.0,&gt;=2.20
  Using cached requests-2.23.0-py2.py3-none-any.whl (58 kB)
Collecting chardet&lt;4,&gt;=3.0.2
  Using cached chardet-3.0.4-py2.py3-none-any.whl (133 kB)
Collecting certifi&gt;=2017.4.17
  Using cached certifi-2019.11.28-py2.py3-none-any.whl (156 kB)
Collecting urllib3!=1.25.0,!=1.25.1,&lt;1.26,&gt;=1.21.1
  Using cached urllib3-1.25.8-py2.py3-none-any.whl (125 kB)
Collecting idna&lt;3,&gt;=2.5
  Using cached idna-2.9-py2.py3-none-any.whl (58 kB)
Processing ./.cache/pip/wheels/8d/f1/0f/7a44efed707005d6df5b9823293aff1e1fbd69b1649f125a8b/cryptography-2.8-cp36-cp36m-linux_x86_64.whl
Collecting pyOpenSSL&gt;=0.14; extra == "security"
  Using cached pyOpenSSL-19.1.0-py2.py3-none-any.whl (53 kB)
Collecting six&gt;=1.4.1
  Using cached six-1.14.0-py2.py3-none-any.whl (10 kB)
Processing ./.cache/pip/wheels/6c/6b/5c/30ce64a958139dc1f16109f1393d258aa13057d266b58cb486/cffi-1.14.0-cp36-cp36m-linux_x86_64.whl
Collecting pycparser
  Using cached pycparser-2.20-py2.py3-none-any.whl (112 kB)
Installing collected packages: toml, chardet, certifi, urllib3, idna, six, pycparser, cffi, cryptography, pyOpenSSL, requests, encapsia-api
Successfully installed certifi-2019.11.28 cffi-1.14.0 chardet-3.0.4 cryptography-2.8 encapsia-api-0.1.22 idna-2.9 pyOpenSSL-19.1.0 pycparser-2.20 requests-2.23.0 six-1.14.0 toml-0.10.0 urllib3-1.25.8
Installing tasks in to namespace example
Installed task file /home/ice/example/test_module.py
Configuring 1 task workers for namespace example
Creating views namespace example
Created PostgreSQL schema: example
Installing views in to namespace example
Installing view permissions.sql
Installing view test_views.sql
Not publishing empty tags list.
Installing schedules in to namespace example</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run view with no arguments ===</span>
&gt;encapsia run view example test_no_args
<span class="ansi32">[
    {
        "answer": "function with no arguments"
    }
]</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run view and save result to file ===</span>
&gt;encapsia run view example test_no_args --save-as /tmp/encapsia_test_save_from_view.txt
<span class="ansi33">Response saved to: /tmp/encapsia_test_save_from_view.txt (mime_type=application/json)</span>
&gt;echo $(cat /tmp/encapsia_test_save_from_view.txt)
[{"answer": "function with no arguments"}]
&gt;rm /tmp/encapsia_test_save_from_view.txt

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run view with one argument ===</span>
&gt;encapsia run view example test_one_arg hello
<span class="ansi32">[
    {
        "argument": "hello"
    }
]</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run view with two arguments ===</span>
&gt;encapsia run view example test_two_args "hello" " world"
<span class="ansi32">[
    {
        "test_two_args": "hello world"
    }
]</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run view with no arguments to return meta ===</span>
&gt;encapsia run view example test_only_meta
<span class="ansi32">[
    {
        "test_only_meta": {
            "capabilities": [
                "superuser"
            ],
            "device": null,
            "email": "system@root.encapsia.com",
            "expires_at": "2021-03-10T16:31:18.118559+00:00",
            "id": 95,
            "issued_at": "2020-03-10T16:31:18.118559+00:00",
            "name": "Root Superuser",
            "namespace": "example",
            "notification_token": null,
            "role": null,
            "role_alias": null,
            "site_id": "",
            "token": "eeab0effbb6b484ba4d9b6b9b1f1cddc",
            "url": "https://analytics1.icethree.com/v1/views/example/test_only_meta"
        }
    }
]</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run view with one optional argument ===</span>
&gt;encapsia run view example test_one_optional_arg
<span class="ansi32">[
    {
        "test_one_optional_arg": 1000
    }
]</span>
&gt;encapsia run view example test_one_optional_arg limit=999
<span class="ansi32">[
    {
        "test_one_optional_arg": 999
    }
]</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run view with mixture of argument types ===</span>
&gt;encapsia run view example test_mixture hello limit=123
<span class="ansi32">[
    {
        "test_mixture": {
            "arg1": "hello",
            "limit": 123,
            "meta": {
                "capabilities": [
                    "superuser"
                ],
                "device": null,
                "email": "system@root.encapsia.com",
                "expires_at": "2021-03-10T16:31:18.118559+00:00",
                "id": 95,
                "issued_at": "2020-03-10T16:31:18.118559+00:00",
                "name": "Root Superuser",
                "namespace": "example",
                "notification_token": null,
                "role": null,
                "role_alias": null,
                "site_id": "",
                "token": "eeab0effbb6b484ba4d9b6b9b1f1cddc",
                "url": "https://analytics1.icethree.com/v1/views/example/test_mixture/hello?limit=123"
            }
        }
    }
]</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run view which returns CSV directly ===</span>
&gt;encapsia run view --post example example_view_function_as_csv_file
<span class="ansi32">"x,y\n\"1\",\"2\"\n\"3\",\"4\"\n"</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run view which populates table from CSV file ===</span>
&gt;encapsia run view --post example example_create_and_populate_table --upload treaties.csv
<span class="ansi32">[
    {
        "n_records": 4
    }
]</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run view and use save as ===</span>
&gt;encapsia run view example test_one_optional_arg --save-as=/tmp/test_view_download.json
<span class="ansi33">Response saved to: /tmp/test_view_download.json (mime_type=application/json)</span>
&gt;echo -n '[{"test_one_optional_arg": 1000}]'
&gt;diff -s /tmp/test_view_download.json -
Files /tmp/test_view_download.json and - are identical
&gt;rm /tmp/test_view_download.json

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run view which returns CSV directly and use save as ===</span>
&gt;encapsia run view --post example example_view_function_as_csv_file --save-as=/tmp/test_view_download.csv
<span class="ansi33">Response saved to: /tmp/test_view_download.csv (mime_type=text/csv)</span>
&gt;cat /tmp/test_view_download.csv
x,y
"1","2"
"3","4"
&gt;rm /tmp/test_view_download.csv

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run basic test task function ===</span>
&gt;encapsia run task example test_module.test_function name=tim
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">..</span><span class="ansi33">Done</span>
<span class="ansi32">"hello tim"</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run basic test task function and save result to file ===</span>
&gt;encapsia run task example test_module.test_function --save-as /tmp/encapsia_test_save_from_task.txt name=tim
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">..</span><span class="ansi33">Done</span>
<span class="ansi33">Response saved to: /tmp/encapsia_test_save_from_task.txt (mime_type=application/json)</span>
&gt;echo $(cat /tmp/encapsia_test_save_from_task.txt)
"hello tim"
&gt;rm /tmp/encapsia_test_save_from_task.txt

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run basic test task function with blank argument ===</span>
&gt;encapsia run task example test_module.test_function name=
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi32">"hello "</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run test task function written with fixed arguments ===</span>
&gt;encapsia run task example test_module.test_function_with_fixed_args name=tim
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">..</span><span class="ansi33">Done</span>
<span class="ansi32">"hello tim"</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run test task function accepting any arguments ===</span>
&gt;encapsia run task example test_module.test_function_with_any_args a=1 b=2 c=3
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">..</span><span class="ansi33">Done</span>
<span class="ansi32">{
    "a": "1",
    "b": "2",
    "c": "3",
    "meta": {
        "capabilities": [
            "superuser"
        ],
        "device": null,
        "email": "system@root.encapsia.com",
        "expires_at": "2020-03-10T16:44:28.167590+00:00",
        "id": 95,
        "issued_at": "2020-03-10T16:34:28.167590+00:00",
        "name": "Root Superuser",
        "namespace": "example",
        "notification_token": null,
        "role": null,
        "role_alias": null,
        "site_id": "",
        "token": "cafd107058d540ffa1ec28cca4a407d5",
        "url": "https://analytics1.icethree.com/v1/tasks/example/test_module.test_function_with_any_args?a=1&amp;b=2&amp;c=3"
    }
}</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run test task function which only takes meta as a fixed argument ===</span>
&gt;encapsia run task example test_module.test_function_with_meta_as_fixed_arg
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">..</span><span class="ansi33">Done</span>
<span class="ansi32">{
    "capabilities": [
        "superuser"
    ],
    "device": null,
    "email": "system@root.encapsia.com",
    "expires_at": "2020-03-10T16:44:29.217117+00:00",
    "id": 95,
    "issued_at": "2020-03-10T16:34:29.217117+00:00",
    "name": "Root Superuser",
    "namespace": "example",
    "notification_token": null,
    "role": null,
    "role_alias": null,
    "site_id": "",
    "token": "da3efdce446a4d0d9a54f1e188693c27",
    "url": "https://analytics1.icethree.com/v1/tasks/example/test_module.test_function_with_meta_as_fixed_arg"
}</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run task function with uploaded text data. ===</span>
&gt;encapsia run task example test_module.test_function_for_posted_data --upload=example_data.txt
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">..</span><span class="ansi33">Done</span>
<span class="ansi32">"I've been uploaded from a file!"</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run task function with uploaded json data. ===</span>
&gt;encapsia run task example test_module.test_function_for_posted_data --upload=example_data.json
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">..</span><span class="ansi33">Done</span>
<span class="ansi32">{
    "name": "Father Christmas"
}</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run task function with uploaded jpg data. ===</span>
&gt;encapsia run task example test_module.test_function_for_posted_data --upload=example_data.jpg
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi32">"\u042a\u044c\u042a\u0448\u0000C\u0000\u0003\u0002\u0002\u0002\u0002\u0002\u0003\u0002\u0002\u0002\u0003\u0003\u0003\u0003\u0004\u0006\u0004\u0004\u0004\u0004\u0004\b\u0006\u0006\u0005\u0006\t\b\n\n\t\b\t\t\n\f\u000f\f\n\u000b\u000e\u000b\t\t\r\u0011\r\u000e\u000f\u0010\u0010\u0011\u0010\n\f\u0012\u0013\u0012\u0010\u0013\u000f\u0010\u0010\u0010\u042a\u0438\u0000\u000b\b\u0000\u0001\u0000\u0001\u0001\u0001\u0011\u0000\u042a\u043b\u0000\u0006\u0000\u0010\u0010\u0005\u042a\u0437\u0000\b\u0001\u0001\u0000\u0000?\u0000\u0440\u043e \u042a\u044b"</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run task function with uploaded json data. ===</span>
&gt;encapsia run task example test_module.test_function_for_posted_data --upload=example_data.json
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">..</span><span class="ansi33">Done</span>
<span class="ansi32">{
    "name": "Father Christmas"
}</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run task function with uploaded jpg data. ===</span>
&gt;encapsia run task example test_module.test_function_for_posted_data --upload=example_data.jpg
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi32">"\u042a\u044c\u042a\u0448\u0000C\u0000\u0003\u0002\u0002\u0002\u0002\u0002\u0003\u0002\u0002\u0002\u0003\u0003\u0003\u0003\u0004\u0006\u0004\u0004\u0004\u0004\u0004\b\u0006\u0006\u0005\u0006\t\b\n\n\t\b\t\t\n\f\u000f\f\n\u000b\u000e\u000b\t\t\r\u0011\r\u000e\u000f\u0010\u0010\u0011\u0010\n\f\u0012\u0013\u0012\u0010\u0013\u000f\u0010\u0010\u0010\u042a\u0438\u0000\u000b\b\u0000\u0001\u0000\u0001\u0001\u0001\u0011\u0000\u042a\u043b\u0000\u0006\u0000\u0010\u0010\u0005\u042a\u0437\u0000\b\u0001\u0001\u0000\u0000?\u0000\u0440\u043e \u042a\u044b"</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run task function with uploaded text data and use save as. ===</span>
&gt;encapsia run task example test_module.test_function_for_posted_data --upload=example_data.txt --save-as=/tmp/example_data.txt
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">..</span><span class="ansi33">Done</span>
<span class="ansi33">Response saved to: /tmp/example_data.txt (mime_type=application/json)</span>
&gt;echo -n "\"$(cat example_data.txt)\""
&gt;diff -s /tmp/example_data.txt -
Files /tmp/example_data.txt and - are identical
&gt;rm /tmp/example_data.txt

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run task function with uploaded json data and use save as. ===</span>
&gt;encapsia run task example test_module.test_function_for_posted_data --upload=example_data.json --save-as=/tmp/example_data.json
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Response saved to: /tmp/example_data.json (mime_type=application/json)</span>
&gt;diff -s example_data.json /tmp/example_data.json
Files example_data.json and /tmp/example_data.json are identical
&gt;rm /tmp/example_data.json

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run task function with uploaded jpg data and use save as. ===</span>
&gt;encapsia run task example test_module.test_function_for_posted_data --upload=example_data.jpg --save-as=/tmp/example_data.jpg
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Response saved to: /tmp/example_data.jpg (mime_type=image/jpeg)</span>
&gt;diff -s example_data.jpg /tmp/example_data.jpg
Files example_data.jpg and /tmp/example_data.jpg are identical
&gt;rm /tmp/example_data.jpg

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run task function which takes no arguments. This *should* fail!!! ===</span>
&gt;encapsia run task example test_module.test_function_with_no_args
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi31">
Status: failed</span>
<span class="ansi31">Traceback (most recent call last):
  File "/home/ice/.local/share/virtualenvs/example/lib/python3.6/site-packages/rq/worker.py", line 793, in perform_job
    rv = job.perform()
  File "/home/ice/.local/share/virtualenvs/example/lib/python3.6/site-packages/rq/job.py", line 599, in perform
    self._result = self._execute()
  File "/home/ice/.local/share/virtualenvs/example/lib/python3.6/site-packages/rq/job.py", line 605, in _execute
    return self.func(*self.args, **self.kwargs)
TypeError: test_function_with_no_args() got an unexpected keyword argument 'meta'
</span>
Aborted!
&gt;true

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run task function with fixed arg and no meta. This *should* fail!!! ===</span>
&gt;encapsia run task example test_module.test_function_with_single_arg_and_no_meta name=tim
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi31">
Status: failed</span>
<span class="ansi31">Traceback (most recent call last):
  File "/home/ice/.local/share/virtualenvs/example/lib/python3.6/site-packages/rq/worker.py", line 793, in perform_job
    rv = job.perform()
  File "/home/ice/.local/share/virtualenvs/example/lib/python3.6/site-packages/rq/job.py", line 599, in perform
    self._result = self._execute()
  File "/home/ice/.local/share/virtualenvs/example/lib/python3.6/site-packages/rq/job.py", line 605, in _execute
    return self.func(*self.args, **self.kwargs)
TypeError: test_function_with_single_arg_and_no_meta() got an unexpected keyword argument 'meta'
</span>
Aborted!
&gt;true

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run task function with arg and no meta. This *should* fail!!! ===</span>
&gt;encapsia run task example test_module.test_function_with_single_kwarg name=tim
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi31">
Status: failed</span>
<span class="ansi31">Traceback (most recent call last):
  File "/home/ice/.local/share/virtualenvs/example/lib/python3.6/site-packages/rq/worker.py", line 793, in perform_job
    rv = job.perform()
  File "/home/ice/.local/share/virtualenvs/example/lib/python3.6/site-packages/rq/job.py", line 599, in perform
    self._result = self._execute()
  File "/home/ice/.local/share/virtualenvs/example/lib/python3.6/site-packages/rq/job.py", line 605, in _execute
    return self.func(*self.args, **self.kwargs)
TypeError: test_function_with_single_kwarg() got an unexpected keyword argument 'meta'
</span>
Aborted!
&gt;true

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run task function expecting uploaded data but without any data. This *should* fail!!! ===</span>
&gt;encapsia run task example test_module.test_function_for_posted_data
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi31">
Status: failed</span>
<span class="ansi31">Traceback (most recent call last):
  File "/home/ice/.local/share/virtualenvs/example/lib/python3.6/site-packages/rq/worker.py", line 793, in perform_job
    rv = job.perform()
  File "/home/ice/.local/share/virtualenvs/example/lib/python3.6/site-packages/rq/job.py", line 599, in perform
    self._result = self._execute()
  File "/home/ice/.local/share/virtualenvs/example/lib/python3.6/site-packages/rq/job.py", line 605, in _execute
    return self.func(*self.args, **self.kwargs)
  File "./test_module.py", line 70, in test_function_for_posted_data
    with open(posted_data_filename, "rb") as f_read:
TypeError: expected str, bytes or os.PathLike object, not NoneType
</span>
Aborted!
&gt;true

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run job function and return (JSON) result ===</span>
&gt;encapsia run job example test_module.test_function_for_a_job name=Tim
<span class="ansi33">Running job example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi32">"Hello Tim"</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run job function and save (JSON) result ===</span>
&gt;encapsia run job example test_module.test_function_for_a_job name=Tim --save-as=/tmp/test_job_result.json
<span class="ansi33">Running job example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Response saved to: /tmp/test_job_result.json (mime_type=application/json)</span>
&gt;echo $(cat /tmp/test_job_result.json)
"Hello Tim"
&gt;rm /tmp/test_job_result.json

<span class="ansi93"></span><span class="ansi1 ansi93">=== Add superuser ===</span>
&gt;encapsia users add-superuser tcorbettclark@cmedtechnology.com Timothy Corbett-Clark

<span class="ansi93"></span><span class="ansi1 ansi93">=== List all superusers ===</span>
&gt;encapsia users list --super-users
<span class="ansi32">[Super users]</span>
<span class="ansi32">email                              first_name    last_name
---------------------------------  ------------  -------------
azuresuperuser@cmedtechnology.com  Azure         Superuser
cmedice.superuser@gmail.com        CmedIce       Superuser
tcorbettclark@cmedtechnology.com   Timothy       Corbett-Clark</span>
<span class="ansi32"></span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Delete superuser ===</span>
&gt;encapsia users delete tcorbettclark@cmedtechnology.com

<span class="ansi93"></span><span class="ansi1 ansi93">=== Add system user ===</span>
&gt;encapsia users add-systemuser a-description cap1,cap2,cap3

<span class="ansi93"></span><span class="ansi1 ansi93">=== List all system users ===</span>
&gt;encapsia users list --system-users
<span class="ansi32">[System users]</span>
<span class="ansi32">email                              description    capabilities
---------------------------------  -------------  ------------------------
system@a-description.encapsia.com  A-description  ('cap1', 'cap2', 'cap3')</span>
<span class="ansi32"></span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Delete system user ===</span>
&gt;encapsia users delete system@a-description.encapsia.com

<span class="ansi93"></span><span class="ansi1 ansi93">=== List all users ===</span>
&gt;encapsia users list --all-users
<span class="ansi32">[All users]</span>
<span class="ansi32">email                              first_name    last_name    role       enabled    is_site_user
---------------------------------  ------------  -----------  ---------  ---------  --------------
azuresuperuser@cmedtechnology.com  Azure         Superuser    Superuser  True       False
cmedice.superuser@gmail.com        CmedIce       Superuser    Superuser  True       False</span>
<span class="ansi32"></span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Export all users and roles ===</span>
&gt;encapsia users export /tmp/test_encapsia_users.toml
<span class="ansi32">Exported 2 users and 2 roles to /tmp/test_encapsia_users.toml</span>
&gt;cat /tmp/test_encapsia_users.toml
[[users]]
email = "azuresuperuser@cmedtechnology.com"
first_name = "Azure"
last_name = "Superuser"
is_site_user = false
role = "Superuser"
enabled = true

[[users]]
email = "cmedice.superuser@gmail.com"
first_name = "CmedIce"
last_name = "Superuser"
is_site_user = false
role = "Superuser"
enabled = true

[[roles]]
name = "Superuser"
alias = "Superuser"
capabilities = [ "superuser",]

[[roles]]
name = "System - A-description"
alias = "System - A-description"
capabilities = [ "cap1", "cap2", "cap3",]


<span class="ansi93"></span><span class="ansi1 ansi93">=== Import users and roles ===</span>
&gt;encapsia users import /tmp/test_encapsia_users.toml
<span class="ansi32">Imported 2 users and 2 roles from /tmp/test_encapsia_users.toml</span>
&gt;rm /tmp/test_encapsia_users.toml

<span class="ansi34"></span><span class="ansi1 ansi34">&lt;&lt;&lt; End of tests &gt;&gt;&gt;</span>

</pre>
</body>

</html>
