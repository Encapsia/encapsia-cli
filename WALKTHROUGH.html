<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title></title>
<style type="text/css">
.ansi2html-content { display: inline; white-space: pre-wrap; word-wrap: break-word; }
.body_foreground { color: #AAAAAA; }
.body_background { background-color: #000000; }
.body_foreground > .bold,.bold > .body_foreground, body.body_foreground > pre > .bold { color: #FFFFFF; font-weight: normal; }
.inv_foreground { color: #000000; }
.inv_background { background-color: #AAAAAA; }
.ansi1 { font-weight: bold; }
.ansi31 { color: #aa0000; }
.ansi32 { color: #00aa00; }
.ansi33 { color: #aa5500; }
.ansi93 { color: #ea9540; }
</style>
</head>
<body class="body_foreground body_background" style="font-size: 80%;" >
<pre class="ansi2html-content">
Exercise encapsia commands.
These are *not* self-verifying tests, so check the output for reasonableness!

<span class="ansi93"></span><span class="ansi1 ansi93">=== Print out overall help ===</span>
&gt;encapsia help
<span class="ansi33">Usage: encapsia help [OPTIONS] COMMAND [ARGS]...

  CLI to talk to an encapsia host.

  The following steps are used to determine the server URL and token:

    If provided, use the --host option to reference an entry in ~/.encapsia/credentials.toml
    Else if set, use ENCAPSIA_HOST to reference an entry in ~/.encapsia/credentials.toml
    Else if set, use ENCAPSIA_URL and ENCAPSIA_TOKEN directly.
    Else abort.

  The tool will also abort if instructed to lookup in
  ~/.encapsia/credentials.toml but cannot find a correct entry.

Options:
  --help  Show this message and exit.

Commands:
  config    Get/set server configuration.
  database  Backups and Restore encapsia databases.
  fixtures  Manage database fixtures.
  help      Print longer help information about the CLI.
  httpie    Helper to use httpie with the URL and credentials passed in.
  plugins   Install, uninstall, create, and update plugins.
  run       Run an Encapsia task, job, or view.
  schedule  Manage task schedules.
  shell     Start an interactive shell for running the encapsia commands.
  token     Do things with an encapsia token.
  users     Manage users, including superuser and system users.
  version   Print version information about the CLI.</span>
<span class="ansi33"></span>
<span class="ansi33">Subcommands:</span>
<span class="ansi33">  config delete                       Delete value against given key.</span>
<span class="ansi33">  config get                          Retrieve value against given key.</span>
<span class="ansi33">  config load                         Load (merge) configuration from given file.</span>
<span class="ansi33">  config save                         Save entire configuration to given file.</span>
<span class="ansi33">  config set                          Store value against given key.</span>
<span class="ansi33">  config show                         Show entire configuration.</span>
<span class="ansi33">  database backup                     Backup database to given filename.</span>
<span class="ansi33">  database restore                    Restore database from given backup file.</span>
<span class="ansi33">  fixtures create                     Create new fixture with given name.</span>
<span class="ansi33">  fixtures delete                     Delete fixture with given name.</span>
<span class="ansi33">  fixtures list                       List available fixtures.</span>
<span class="ansi33">  fixtures use                        Switch to fixture with given name.</span>
<span class="ansi33">  httpie shell                        Launch an httpie interactive shell with...</span>
<span class="ansi33">  plugins build-from-legacy-s3        Build plugins from legacy webapps hosted on...</span>
<span class="ansi33">  plugins build-from-src              Build plugins from given source directories.</span>
<span class="ansi33">  plugins dev-create-namespace        Create namespace of given name.</span>
<span class="ansi33">  plugins dev-destroy-namespace       Destroy namespace of given name.</span>
<span class="ansi33">  plugins dev-list-namespaces         Provide some information about the namespace...</span>
<span class="ansi33">  plugins dev-update                  Update plugin parts which have changed since...</span>
<span class="ansi33">  plugins fetch-from-url              Copy a plugin from given URL into the plugin...</span>
<span class="ansi33">  plugins info                        Provide information about installed plugins.</span>
<span class="ansi33">  plugins install                     Install plugins from files and/or an optional...</span>
<span class="ansi33">  plugins uninstall                   Uninstall named plugin.</span>
<span class="ansi33">  run job                             Run a job in given plugin NAMESPACE and...</span>
<span class="ansi33">  run task                            Run a task in given plugin NAMESPACE and...</span>
<span class="ansi33">  run view                            Run a view in given plugin NAMESPACE and...</span>
<span class="ansi33">  schedule add                        Add new scheduled task.</span>
<span class="ansi33">  schedule list                       List all scheduled tasks.</span>
<span class="ansi33">  schedule remove-task                Remove scheduled task by id.</span>
<span class="ansi33">  schedule remove-tasks-in-namespace  Remove all scheduled tasks in given...</span>
<span class="ansi33">  token expire                        Expire token from server, and update encapsia...</span>
<span class="ansi33">  token extend                        Extend the lifespan of token and update...</span>
<span class="ansi33">  token whoami                        Print information about current owner of...</span>
<span class="ansi33">  users add-superuser                 Create superuser with suitable user and role.</span>
<span class="ansi33">  users add-systemuser                Create system user with suitable user and...</span>
<span class="ansi33">  users delete                        Delete user (but *do not* delete any related...</span>
<span class="ansi33">  users list                          List out information about users.</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Print out help on help ===</span>
&gt;encapsia help help
<span class="ansi33">Usage: encapsia help [OPTIONS] [COMMAND]

  Print longer help information about the CLI.

Options:
  --colour [always|never|auto]  Control colour on stdout.
  --help                        Show this message and exit.</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Print out help on users ===</span>
&gt;encapsia help users
<span class="ansi33">Usage: encapsia help [OPTIONS] COMMAND [ARGS]...

  Manage users, including superuser and system users.

Options:
  --colour [always|never|auto]  Control colour on stdout.
  --host TEXT                   Name to use to lookup credentials in
                                .encapsia/credentials.toml
  --help                        Show this message and exit.

Commands:
  add-superuser   Create superuser with suitable user and role.
  add-systemuser  Create system user with suitable user and role.
  delete          Delete user (but *do not* delete any related role).
  list            List out information about users.</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Print out the version ===</span>
&gt;encapsia version
<span class="ansi33">Encapsia CLI version: 0.1.15</span>
<span class="ansi33">Encapsia API version: 0.1.21</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Get whoami info about current token ===</span>
&gt;encapsia token whoami
<span class="ansi32">id = 59
name = "Timothy Corbett-Clark"
email = "tcorbettclark@cmedtechnology.com"
capabilities = [ "superuser",]
expires_at = "2020-08-28T14:10:15.748819+00:00"
issued_at = "2019-08-29T14:10:15.748819+00:00"
role = "Superuser"
enabled = true
last_name = "Corbett-Clark"
first_name = "Timothy"
role_alias = "Superuser"
is_site_user = false
token = "e4997e714ab04490b32e68bdd16d8c02"
</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Extend lifespan of token (changes the encapsia credentials) ===</span>
&gt;encapsia token extend
<span class="ansi33">Encapsia credentials file updated.</span>
&gt;encapsia token whoami
<span class="ansi32">id = 86
name = "Timothy Corbett-Clark"
email = "tcorbettclark@cmedtechnology.com"
capabilities = [ "superuser",]
expires_at = "2020-08-28T15:52:50.473495+00:00"
issued_at = "2019-08-29T15:52:50.473495+00:00"
role = "Superuser"
enabled = true
last_name = "Corbett-Clark"
first_name = "Timothy"
role_alias = "Superuser"
is_site_user = false
token = "dfce4d249a154c65bf3ae7b9f57acb0c"
</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Set a config value to a string ===</span>
&gt;encapsia config set test_string \"a_string\"
&gt;encapsia config get test_string
<span class="ansi32">"a_string"</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Set a config value to a number ===</span>
&gt;encapsia config set test_number 123
&gt;encapsia config get test_number
<span class="ansi32">123</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Set a config value to a list ===</span>
&gt;encapsia config set test_list '["a", 1]'
&gt;encapsia config get test_list
<span class="ansi32">[
    "a",
    1
]</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Delete config values ===</span>
&gt;encapsia config delete test_string
&gt;encapsia config delete test_number
&gt;encapsia config delete test_list

<span class="ansi93"></span><span class="ansi1 ansi93">=== Save config to a file and load it again ===</span>
&gt;encapsia config save /tmp/test_encapsia_config.json
&gt;cat /tmp/test_encapsia_config.json
{
    "blob_lifespan": 3600,
    "blob_path": "/v1/blobs/{id}",
    "firebase": {
        "profiles": {
            "chat": {
                "secret": "Kpforr0KblWZddZe70q9dTvEe1c34hfKaPdvXmVX",
                "url": "https://glaring-inferno-5677.firebaseio.com"
            },
            "tutor": {
                "secret": "Kpforr0KblWZddZe70q9dTvEe1c34hfKaPdvXmVX",
                "url": "https://glaring-inferno-5677.firebaseio.com/activitydata/"
            }
        }
    },
    "graph_tenant_id": "cmedtechnology.com",
    "html2pdf": {
        "conversionUrl": "https://SHpO3zw1zlHLpsOyY4@docraptor.com/docs",
        "statusUrl": "https://SHpO3zw1zlHLpsOyY4@docraptor.com/status"
    },
    "job_timeout": 3600,
    "node": "dawn",
    "oauth2_azure": {
        "additional_auth_parameters": {
            "sign": "sign"
        },
        "auth_uri": "https://login.windows.net/2a0d4e61-e0c9-4e26-a615-5c7ff13ea03b/oauth2/authorize?api-version=1.0&amp;prompt=login",
        "client_id": "889c979a-939e-47ad-b595-1ac1525a7162",
        "client_secret": "sLI86aqMw+mnGeSCmpaWP/IFqwyr0h4jg95A6uGZ3cc=",
        "email_jwt_key": "unique_name",
        "scope": "openid email",
        "token_uri": "https://login.windows.net/2a0d4e61-e0c9-4e26-a615-5c7ff13ea03b/oauth2/token"
    },
    "oauth2_google": {
        "additional_auth_parameters": {
            "prefill_email": "login_hint"
        },
        "auth_uri": "https://accounts.google.com/o/oauth2/auth?max_auth_age=0",
        "client_id": "728530777116.apps.googleusercontent.com",
        "client_secret": "8OnW6IYHPMKi6O9TfFXhc7zi",
        "scope": "openid email",
        "token_uri": "https://accounts.google.com/o/oauth2/token"
    },
    "oauth2_providers": [
        "google",
        "azure"
    ],
    "oauth2_reply_html": "&lt;!DOCTYPE html&gt;\n&lt;html lang='en'&gt;\n  &lt;head&gt;\n    &lt;meta charset=\"utf-8\"&gt;\n    &lt;title&gt;ICE login&lt;/title&gt;\n    &lt;script&gt;\n    var isLoginSuccess = false;\n    try {\n        if (typeof opener.handleLoginSuccess != 'undefined') {\n            opener.handleLoginSuccess(\n                '{{status|e}}:{{data|e}}', '{{return_url|e}}');\n            isLoginSuccess = true;\n        }\n    } catch (err) {\n        console.log('CORS error usually when using icewebautologin');\n    }\n    if (!isLoginSuccess) {\n        opener.postMessage('{{status|e}}:{{data|e}}', '{{return_url|e}}');\n    }\n    window.close();\n    &lt;/script&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;input type=\"hidden\" name=\"hiddenStatus\" value='{{status|e}}'&gt;\n    &lt;input type=\"hidden\" name=\"hiddenData\" value='{{data|e}}'&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n",
    "root_token": "&lt;hidden&gt;",
    "session_lifespan": 604800,
    "task_timeout": 600,
    "trial": "dawn",
    "url": "https://dawn.icethree.com",
    "view_lifespan": 600
}&gt;cat /tmp/test_encapsia_config.json
&gt;python -c "import json, sys; c=json.load(sys.stdin); del c['root_token']; print(json.dumps(c))" &gt; /tmp/test_encapsia_config2.json
&gt;encapsia config load /tmp/test_encapsia_config2.json
&gt;rm /tmp/test_encapsia_config*.json

<span class="ansi93"></span><span class="ansi1 ansi93">=== Show the entire config ===</span>
&gt;encapsia config show
<span class="ansi32">{
    "blob_lifespan": 3600,
    "blob_path": "/v1/blobs/{id}",
    "firebase": {
        "profiles": {
            "chat": {
                "secret": "Kpforr0KblWZddZe70q9dTvEe1c34hfKaPdvXmVX",
                "url": "https://glaring-inferno-5677.firebaseio.com"
            },
            "tutor": {
                "secret": "Kpforr0KblWZddZe70q9dTvEe1c34hfKaPdvXmVX",
                "url": "https://glaring-inferno-5677.firebaseio.com/activitydata/"
            }
        }
    },
    "graph_tenant_id": "cmedtechnology.com",
    "html2pdf": {
        "conversionUrl": "https://SHpO3zw1zlHLpsOyY4@docraptor.com/docs",
        "statusUrl": "https://SHpO3zw1zlHLpsOyY4@docraptor.com/status"
    },
    "job_timeout": 3600,
    "node": "dawn",
    "oauth2_azure": {
        "additional_auth_parameters": {
            "sign": "sign"
        },
        "auth_uri": "https://login.windows.net/2a0d4e61-e0c9-4e26-a615-5c7ff13ea03b/oauth2/authorize?api-version=1.0&amp;prompt=login",
        "client_id": "889c979a-939e-47ad-b595-1ac1525a7162",
        "client_secret": "sLI86aqMw+mnGeSCmpaWP/IFqwyr0h4jg95A6uGZ3cc=",
        "email_jwt_key": "unique_name",
        "scope": "openid email",
        "token_uri": "https://login.windows.net/2a0d4e61-e0c9-4e26-a615-5c7ff13ea03b/oauth2/token"
    },
    "oauth2_google": {
        "additional_auth_parameters": {
            "prefill_email": "login_hint"
        },
        "auth_uri": "https://accounts.google.com/o/oauth2/auth?max_auth_age=0",
        "client_id": "728530777116.apps.googleusercontent.com",
        "client_secret": "8OnW6IYHPMKi6O9TfFXhc7zi",
        "scope": "openid email",
        "token_uri": "https://accounts.google.com/o/oauth2/token"
    },
    "oauth2_providers": [
        "google",
        "azure"
    ],
    "oauth2_reply_html": "&lt;!DOCTYPE html&gt;\n&lt;html lang='en'&gt;\n  &lt;head&gt;\n    &lt;meta charset=\"utf-8\"&gt;\n    &lt;title&gt;ICE login&lt;/title&gt;\n    &lt;script&gt;\n    var isLoginSuccess = false;\n    try {\n        if (typeof opener.handleLoginSuccess != 'undefined') {\n            opener.handleLoginSuccess(\n                '{{status|e}}:{{data|e}}', '{{return_url|e}}');\n            isLoginSuccess = true;\n        }\n    } catch (err) {\n        console.log('CORS error usually when using icewebautologin');\n    }\n    if (!isLoginSuccess) {\n        opener.postMessage('{{status|e}}:{{data|e}}', '{{return_url|e}}');\n    }\n    window.close();\n    &lt;/script&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;input type=\"hidden\" name=\"hiddenStatus\" value='{{status|e}}'&gt;\n    &lt;input type=\"hidden\" name=\"hiddenData\" value='{{data|e}}'&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n",
    "root_token": "&lt;hidden&gt;",
    "session_lifespan": 604800,
    "task_timeout": 600,
    "trial": "dawn",
    "url": "https://dawn.icethree.com",
    "view_lifespan": 600
}</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Build the example plugin from src ===</span>
&gt;encapsia plugins --force build-from-src $EXAMPLE_PLUGIN_SRC
<span class="ansi33">Created: /home/tcorbettclark/.encapsia/plugins-cache/plugin-example-0.0.1.tar.gz</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Request a build again, but this time it should be skipped over because it already exists in the cache ===</span>
&gt;encapsia plugins build-from-src $EXAMPLE_PLUGIN_SRC
<span class="ansi33">Found: /home/tcorbettclark/.encapsia/plugins-cache/plugin-example-0.0.1.tar.gz (Skipping)</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Move the example plugin out of the cache and then add it back in directly ===</span>
&gt;mv ~/.encapsia/plugins-cache/plugin-example-0.0.1.tar.gz /tmp/
&gt;encapsia plugins fetch-from-url file:///tmp/plugin-example-0.0.1.tar.gz
<span class="ansi33">Created: /home/tcorbettclark/.encapsia/plugins-cache/plugin-example-0.0.1.tar.gz</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Build the launch plugin from legacy S3 (after first removing from the cache) ===</span>
&gt;rm -f ~/.encapsia/plugins-cache/plugin-launch-*.tar.gz
&gt;encapsia plugins build-from-legacy-s3 --versions=s3_plugins.toml --email=test_user@encapsia.com
<span class="ansi33">Created: /home/tcorbettclark/.encapsia/plugins-cache/plugin-launch-1.2.2.tar.gz</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Second time should be skipped over because it is already in the cache ===</span>
&gt;encapsia plugins build-from-legacy-s3 --versions=s3_plugins.toml --email=test_user@encapsia.com
<span class="ansi33">Found: /home/tcorbettclark/.encapsia/plugins-cache/plugin-launch-1.2.2.tar.gz (Skipping)</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Install the example plugin from the cache, then uninstall it ===</span>
&gt;encapsia plugins install --versions=example.toml
<span class="ansi33">Uploaded /home/tcorbettclark/.encapsia/plugins-cache/plugin-example-0.0.1.tar.gz to blob: 66b79139d8f1479a9506c5eb9b44ccbf</span>
<span class="ansi33">Installing</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Status: ok</span>
<span class="ansi32">Downloaded blob 66b79139d8f1479a9506c5eb9b44ccbf to /tmp/tmp57zblyu9
Extracted /tmp/tmp57zblyu9 into /tmp/tmpz5k1nwng
Registered plugin example (0.0.1) from blob 66b79139d8f1479a9506c5eb9b44ccbf with id cfe3f5743446490089da0fcde85ec3ab
Role needs no update.
Manifest file for example not found.
Destroying plugin namespace: example
No task workers configured for namespace: example
Virtualenv does not exist: example
Tasks directory does not exist: /home/ice/example
Webfiles directory does not exist: /var/share/nginx/iceplugins/example
Views namespace does not exist: example
Remove published permissions, if any
Remove published tags, if any
Removing all/any schedules from plugin namespace: example
Installing plugin example (0.0.1)
Made webfiles directory: /var/share/nginx/iceplugins/example
Installing web files in to namespace example
Installed manifest /var/share/nginx/iceplugins/example/plugin.toml
pew new -d example
Using base prefix '/home/ice/.pyenv/versions/3.6.7'
New python executable in /home/ice/.local/share/virtualenvs/example/bin/python3.6
Also creating executable in /home/ice/.local/share/virtualenvs/example/bin/python
Installing setuptools, pip, wheel...
done.
pew in example pip install redis==2.10.6 rq==0.12.0
Collecting redis==2.10.6
  Using cached https://files.pythonhosted.org/packages/3b/f6/7a76333cf0b9251ecf49efff635015171843d9b977e4ffcf59f9c4428052/redis-2.10.6-py2.py3-none-any.whl
Collecting rq==0.12.0
  Using cached https://files.pythonhosted.org/packages/1d/3f/e05539962949aecd83496736f73abd36bd811884a20f68f691b59805125e/rq-0.12.0-py2.py3-none-any.whl
Collecting click&gt;=5.0 (from rq==0.12.0)
  Using cached https://files.pythonhosted.org/packages/fa/37/45185cb5abbc30d7257104c434fe0b07e5a195a6847506c074527aa599ec/Click-7.0-py2.py3-none-any.whl
Installing collected packages: redis, click, rq
Successfully installed click-7.0 redis-2.10.6 rq-0.12.0
Made virtualenv: example
Installing wheels in to namespace example
pew in example pip install --find-links /tmp/tmpz5k1nwng/plugin-example-0.0.1/wheels --requirement /tmp/tmpz5k1nwng/plugin-example-0.0.1/wheels/requirements.txt
Looking in links: /tmp/tmpz5k1nwng/plugin-example-0.0.1/wheels
Collecting encapsia-api (from -r /tmp/tmpz5k1nwng/plugin-example-0.0.1/wheels/requirements.txt (line 1))
  Downloading https://files.pythonhosted.org/packages/d5/91/cb039693114295da784256bf070458997ff3aa2f52a6c3505df03a5bf4fc/encapsia_api-0.1.21-py3-none-any.whl
Collecting requests[security]&lt;3.0,&gt;=2.20 (from encapsia-api-&gt;-r /tmp/tmpz5k1nwng/plugin-example-0.0.1/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/51/bd/23c926cd341ea6b7dd0b2a00aba99ae0f828be89d72b2190f27c11d4b7fb/requests-2.22.0-py2.py3-none-any.whl
Collecting toml&lt;0.11.0,&gt;=0.10.0 (from encapsia-api-&gt;-r /tmp/tmpz5k1nwng/plugin-example-0.0.1/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/a2/12/ced7105d2de62fa7c8fb5fce92cc4ce66b57c95fb875e9318dba7f8c5db0/toml-0.10.0-py2.py3-none-any.whl
Collecting chardet&lt;3.1.0,&gt;=3.0.2 (from requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpz5k1nwng/plugin-example-0.0.1/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/bc/a9/01ffebfb562e4274b6487b4bb1ddec7ca55ec7510b22e4c51f14098443b8/chardet-3.0.4-py2.py3-none-any.whl
Collecting idna&lt;2.9,&gt;=2.5 (from requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpz5k1nwng/plugin-example-0.0.1/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/14/2c/cd551d81dbe15200be1cf41cd03869a46fe7226e7450af7a6545bfc474c9/idna-2.8-py2.py3-none-any.whl
Collecting certifi&gt;=2017.4.17 (from requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpz5k1nwng/plugin-example-0.0.1/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/69/1b/b853c7a9d4f6a6d00749e94eb6f3a041e342a885b87340b79c1ef73e3a78/certifi-2019.6.16-py2.py3-none-any.whl
Collecting urllib3!=1.25.0,!=1.25.1,&lt;1.26,&gt;=1.21.1 (from requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpz5k1nwng/plugin-example-0.0.1/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/e6/60/247f23a7121ae632d62811ba7f273d0e58972d75e58a94d329d51550a47d/urllib3-1.25.3-py2.py3-none-any.whl
Collecting pyOpenSSL&gt;=0.14; extra == "security" (from requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpz5k1nwng/plugin-example-0.0.1/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/01/c8/ceb170d81bd3941cbeb9940fc6cc2ef2ca4288d0ca8929ea4db5905d904d/pyOpenSSL-19.0.0-py2.py3-none-any.whl
Collecting cryptography&gt;=1.3.4; extra == "security" (from requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpz5k1nwng/plugin-example-0.0.1/wheels/requirements.txt (line 1))
Collecting six&gt;=1.5.2 (from pyOpenSSL&gt;=0.14; extra == "security"-&gt;requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpz5k1nwng/plugin-example-0.0.1/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/73/fb/00a976f728d0d1fecfe898238ce23f502a721c0ac0ecfedb80e0d88c64e9/six-1.12.0-py2.py3-none-any.whl
Collecting asn1crypto&gt;=0.21.0 (from cryptography&gt;=1.3.4; extra == "security"-&gt;requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpz5k1nwng/plugin-example-0.0.1/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/ea/cd/35485615f45f30a510576f1a56d1e0a7ad7bd8ab5ed7cdc600ef7cd06222/asn1crypto-0.24.0-py2.py3-none-any.whl
Collecting cffi!=1.11.3,&gt;=1.8 (from cryptography&gt;=1.3.4; extra == "security"-&gt;requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpz5k1nwng/plugin-example-0.0.1/wheels/requirements.txt (line 1))
Collecting pycparser (from cffi!=1.11.3,&gt;=1.8-&gt;cryptography&gt;=1.3.4; extra == "security"-&gt;requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpz5k1nwng/plugin-example-0.0.1/wheels/requirements.txt (line 1))
Installing collected packages: chardet, idna, certifi, urllib3, six, asn1crypto, pycparser, cffi, cryptography, pyOpenSSL, requests, toml, encapsia-api
Successfully installed asn1crypto-0.24.0 certifi-2019.6.16 cffi-1.12.3 chardet-3.0.4 cryptography-2.7 encapsia-api-0.1.21 idna-2.8 pyOpenSSL-19.0.0 pycparser-2.19 requests-2.22.0 six-1.12.0 toml-0.10.0 urllib3-1.25.3
Installing tasks in to namespace example
Installed task file /home/ice/example/test_module.py
Configuring 1 task workers for namespace example
Creating views namespace example
Created PostgreSQL schema: example
Installing views in to namespace example
Installing view permissions.sql
Installing view test_views.sql
Not publishing empty tags list.
Installing schedules in to namespace example
Installed plugin with id cfe3f5743446490089da0fcde85ec3ab</span>
&gt;encapsia plugins --force uninstall example
<span class="ansi33">Uninstalling example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Status: ok</span>
<span class="ansi32">Downloaded blob 66b79139d8f1479a9506c5eb9b44ccbf to /tmp/tmpy_wpk7oy
Extracted /tmp/tmpy_wpk7oy into /tmp/tmpo4vbmhjz
Role needs no update.
Destroying plugin namespace: example
Stopped all task workers for namespace: example
Destroyed virtualenv: example
Removed tasks directory: /home/ice/example
Removed webfiles directory: /var/share/nginx/iceplugins/example
Destroying views namespace example
Deleted PostgreSQL schema: example
Remove published permissions, if any
Remove published tags, if any
Removing all/any schedules from plugin namespace: example</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Dev update the example plugin from scratch ===</span>
&gt;encapsia plugins --force dev-update $EXAMPLE_PLUGIN_SRC
<span class="ansi33">Including: tasks</span>
<span class="ansi33">Including: views</span>
<span class="ansi33">Including: wheels</span>
<span class="ansi33">Including: schedules</span>
<span class="ansi33">Uploading to server</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Status: ok</span>
<span class="ansi32">Extracted /tmp/ice/tmpumzhuvmh into /tmp/tmpx5cj6ny_
Installing plugin example (0.0.1)
Made webfiles directory: /var/share/nginx/iceplugins/example
Installing web files in to namespace example
Installed manifest /var/share/nginx/iceplugins/example/plugin.toml
pew new -d example
Using base prefix '/home/ice/.pyenv/versions/3.6.7'
New python executable in /home/ice/.local/share/virtualenvs/example/bin/python3.6
Also creating executable in /home/ice/.local/share/virtualenvs/example/bin/python
Installing setuptools, pip, wheel...
done.
pew in example pip install redis==2.10.6 rq==0.12.0
Collecting redis==2.10.6
  Using cached https://files.pythonhosted.org/packages/3b/f6/7a76333cf0b9251ecf49efff635015171843d9b977e4ffcf59f9c4428052/redis-2.10.6-py2.py3-none-any.whl
Collecting rq==0.12.0
  Using cached https://files.pythonhosted.org/packages/1d/3f/e05539962949aecd83496736f73abd36bd811884a20f68f691b59805125e/rq-0.12.0-py2.py3-none-any.whl
Collecting click&gt;=5.0 (from rq==0.12.0)
  Using cached https://files.pythonhosted.org/packages/fa/37/45185cb5abbc30d7257104c434fe0b07e5a195a6847506c074527aa599ec/Click-7.0-py2.py3-none-any.whl
Installing collected packages: redis, click, rq
Successfully installed click-7.0 redis-2.10.6 rq-0.12.0
Made virtualenv: example
Installing wheels in to namespace example
pew in example pip install --find-links /tmp/tmpx5cj6ny_/tmpob4mzx6i/wheels --requirement /tmp/tmpx5cj6ny_/tmpob4mzx6i/wheels/requirements.txt
Looking in links: /tmp/tmpx5cj6ny_/tmpob4mzx6i/wheels
Collecting encapsia-api (from -r /tmp/tmpx5cj6ny_/tmpob4mzx6i/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/d5/91/cb039693114295da784256bf070458997ff3aa2f52a6c3505df03a5bf4fc/encapsia_api-0.1.21-py3-none-any.whl
Collecting requests[security]&lt;3.0,&gt;=2.20 (from encapsia-api-&gt;-r /tmp/tmpx5cj6ny_/tmpob4mzx6i/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/51/bd/23c926cd341ea6b7dd0b2a00aba99ae0f828be89d72b2190f27c11d4b7fb/requests-2.22.0-py2.py3-none-any.whl
Collecting toml&lt;0.11.0,&gt;=0.10.0 (from encapsia-api-&gt;-r /tmp/tmpx5cj6ny_/tmpob4mzx6i/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/a2/12/ced7105d2de62fa7c8fb5fce92cc4ce66b57c95fb875e9318dba7f8c5db0/toml-0.10.0-py2.py3-none-any.whl
Collecting idna&lt;2.9,&gt;=2.5 (from requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpx5cj6ny_/tmpob4mzx6i/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/14/2c/cd551d81dbe15200be1cf41cd03869a46fe7226e7450af7a6545bfc474c9/idna-2.8-py2.py3-none-any.whl
Collecting certifi&gt;=2017.4.17 (from requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpx5cj6ny_/tmpob4mzx6i/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/69/1b/b853c7a9d4f6a6d00749e94eb6f3a041e342a885b87340b79c1ef73e3a78/certifi-2019.6.16-py2.py3-none-any.whl
Collecting urllib3!=1.25.0,!=1.25.1,&lt;1.26,&gt;=1.21.1 (from requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpx5cj6ny_/tmpob4mzx6i/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/e6/60/247f23a7121ae632d62811ba7f273d0e58972d75e58a94d329d51550a47d/urllib3-1.25.3-py2.py3-none-any.whl
Collecting chardet&lt;3.1.0,&gt;=3.0.2 (from requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpx5cj6ny_/tmpob4mzx6i/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/bc/a9/01ffebfb562e4274b6487b4bb1ddec7ca55ec7510b22e4c51f14098443b8/chardet-3.0.4-py2.py3-none-any.whl
Collecting pyOpenSSL&gt;=0.14; extra == "security" (from requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpx5cj6ny_/tmpob4mzx6i/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/01/c8/ceb170d81bd3941cbeb9940fc6cc2ef2ca4288d0ca8929ea4db5905d904d/pyOpenSSL-19.0.0-py2.py3-none-any.whl
Collecting cryptography&gt;=1.3.4; extra == "security" (from requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpx5cj6ny_/tmpob4mzx6i/wheels/requirements.txt (line 1))
Collecting six&gt;=1.5.2 (from pyOpenSSL&gt;=0.14; extra == "security"-&gt;requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpx5cj6ny_/tmpob4mzx6i/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/73/fb/00a976f728d0d1fecfe898238ce23f502a721c0ac0ecfedb80e0d88c64e9/six-1.12.0-py2.py3-none-any.whl
Collecting asn1crypto&gt;=0.21.0 (from cryptography&gt;=1.3.4; extra == "security"-&gt;requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpx5cj6ny_/tmpob4mzx6i/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/ea/cd/35485615f45f30a510576f1a56d1e0a7ad7bd8ab5ed7cdc600ef7cd06222/asn1crypto-0.24.0-py2.py3-none-any.whl
Collecting cffi!=1.11.3,&gt;=1.8 (from cryptography&gt;=1.3.4; extra == "security"-&gt;requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpx5cj6ny_/tmpob4mzx6i/wheels/requirements.txt (line 1))
Collecting pycparser (from cffi!=1.11.3,&gt;=1.8-&gt;cryptography&gt;=1.3.4; extra == "security"-&gt;requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpx5cj6ny_/tmpob4mzx6i/wheels/requirements.txt (line 1))
Installing collected packages: idna, certifi, urllib3, chardet, six, asn1crypto, pycparser, cffi, cryptography, pyOpenSSL, requests, toml, encapsia-api
Successfully installed asn1crypto-0.24.0 certifi-2019.6.16 cffi-1.12.3 chardet-3.0.4 cryptography-2.7 encapsia-api-0.1.21 idna-2.8 pyOpenSSL-19.0.0 pycparser-2.19 requests-2.22.0 six-1.12.0 toml-0.10.0 urllib3-1.25.3
Installing tasks in to namespace example
Installed task file /home/ice/example/test_module.py
Configuring 1 task workers for namespace example
Creating views namespace example
Created PostgreSQL schema: example
Installing views in to namespace example
Installing view permissions.sql
Installing view test_views.sql
Not publishing empty tags list.
Installing schedules in to namespace example</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Second time round there is nothing to do because nothing has changed ===</span>
&gt;encapsia plugins dev-update $EXAMPLE_PLUGIN_SRC
<span class="ansi33">Nothing to do.</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Modify the example plugin and update again. This time only the tasks should be updated ===</span>
&gt;touch $EXAMPLE_PLUGIN_SRC/tasks/test_new_module.py
&gt;encapsia plugins dev-update $EXAMPLE_PLUGIN_SRC
<span class="ansi33">Including: tasks</span>
<span class="ansi33">Uploading to server</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Status: ok</span>
<span class="ansi32">Extracted /tmp/ice/tmpmabp0m15 into /tmp/tmph1r4onma
Installing plugin example (0.0.1)
Webfiles directory already exists: /var/share/nginx/iceplugins/example
Installing web files in to namespace example
Installed manifest /var/share/nginx/iceplugins/example/plugin.toml
Virtualenv already exists: example
Installing tasks in to namespace example
Installed task file /home/ice/example/test_new_module.py
Installed task file /home/ice/example/test_module.py
Configuring 1 task workers for namespace example
Not publishing empty tags list.</span>
&gt;rm $EXAMPLE_PLUGIN_SRC/tasks/test_new_module.py

<span class="ansi93"></span><span class="ansi1 ansi93">=== Install the non-dev version of the example plugin so we can uninstall it (to be tidy). ===</span>
&gt;encapsia plugins install --versions=example.toml
<span class="ansi33">Uploaded /home/tcorbettclark/.encapsia/plugins-cache/plugin-example-0.0.1.tar.gz to blob: bf15b485ca784763bae101e311c92f13</span>
<span class="ansi33">Installing</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Status: ok</span>
<span class="ansi32">Downloaded blob bf15b485ca784763bae101e311c92f13 to /tmp/tmpsopx1w4z
Extracted /tmp/tmpsopx1w4z into /tmp/tmpqijb9gmg
Registered plugin example (0.0.1) from blob bf15b485ca784763bae101e311c92f13 with id 648d5251729b4cb0ba2e0e4ca8a4d70e
Role needs no update.
Destroying plugin namespace: example
Stopped all task workers for namespace: example
Destroyed virtualenv: example
Removed tasks directory: /home/ice/example
Removed webfiles directory: /var/share/nginx/iceplugins/example
Destroying views namespace example
Deleted PostgreSQL schema: example
Remove published permissions, if any
Remove published tags, if any
Removing all/any schedules from plugin namespace: example
Installing plugin example (0.0.1)
Made webfiles directory: /var/share/nginx/iceplugins/example
Installing web files in to namespace example
Installed manifest /var/share/nginx/iceplugins/example/plugin.toml
pew new -d example
Using base prefix '/home/ice/.pyenv/versions/3.6.7'
New python executable in /home/ice/.local/share/virtualenvs/example/bin/python3.6
Also creating executable in /home/ice/.local/share/virtualenvs/example/bin/python
Installing setuptools, pip, wheel...
done.
pew in example pip install redis==2.10.6 rq==0.12.0
Collecting redis==2.10.6
  Using cached https://files.pythonhosted.org/packages/3b/f6/7a76333cf0b9251ecf49efff635015171843d9b977e4ffcf59f9c4428052/redis-2.10.6-py2.py3-none-any.whl
Collecting rq==0.12.0
  Using cached https://files.pythonhosted.org/packages/1d/3f/e05539962949aecd83496736f73abd36bd811884a20f68f691b59805125e/rq-0.12.0-py2.py3-none-any.whl
Collecting click&gt;=5.0 (from rq==0.12.0)
  Using cached https://files.pythonhosted.org/packages/fa/37/45185cb5abbc30d7257104c434fe0b07e5a195a6847506c074527aa599ec/Click-7.0-py2.py3-none-any.whl
Installing collected packages: redis, click, rq
Successfully installed click-7.0 redis-2.10.6 rq-0.12.0
Made virtualenv: example
Installing wheels in to namespace example
pew in example pip install --find-links /tmp/tmpqijb9gmg/plugin-example-0.0.1/wheels --requirement /tmp/tmpqijb9gmg/plugin-example-0.0.1/wheels/requirements.txt
Looking in links: /tmp/tmpqijb9gmg/plugin-example-0.0.1/wheels
Collecting encapsia-api (from -r /tmp/tmpqijb9gmg/plugin-example-0.0.1/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/d5/91/cb039693114295da784256bf070458997ff3aa2f52a6c3505df03a5bf4fc/encapsia_api-0.1.21-py3-none-any.whl
Collecting toml&lt;0.11.0,&gt;=0.10.0 (from encapsia-api-&gt;-r /tmp/tmpqijb9gmg/plugin-example-0.0.1/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/a2/12/ced7105d2de62fa7c8fb5fce92cc4ce66b57c95fb875e9318dba7f8c5db0/toml-0.10.0-py2.py3-none-any.whl
Collecting requests[security]&lt;3.0,&gt;=2.20 (from encapsia-api-&gt;-r /tmp/tmpqijb9gmg/plugin-example-0.0.1/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/51/bd/23c926cd341ea6b7dd0b2a00aba99ae0f828be89d72b2190f27c11d4b7fb/requests-2.22.0-py2.py3-none-any.whl
Collecting chardet&lt;3.1.0,&gt;=3.0.2 (from requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpqijb9gmg/plugin-example-0.0.1/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/bc/a9/01ffebfb562e4274b6487b4bb1ddec7ca55ec7510b22e4c51f14098443b8/chardet-3.0.4-py2.py3-none-any.whl
Collecting urllib3!=1.25.0,!=1.25.1,&lt;1.26,&gt;=1.21.1 (from requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpqijb9gmg/plugin-example-0.0.1/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/e6/60/247f23a7121ae632d62811ba7f273d0e58972d75e58a94d329d51550a47d/urllib3-1.25.3-py2.py3-none-any.whl
Collecting idna&lt;2.9,&gt;=2.5 (from requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpqijb9gmg/plugin-example-0.0.1/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/14/2c/cd551d81dbe15200be1cf41cd03869a46fe7226e7450af7a6545bfc474c9/idna-2.8-py2.py3-none-any.whl
Collecting certifi&gt;=2017.4.17 (from requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpqijb9gmg/plugin-example-0.0.1/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/69/1b/b853c7a9d4f6a6d00749e94eb6f3a041e342a885b87340b79c1ef73e3a78/certifi-2019.6.16-py2.py3-none-any.whl
Collecting cryptography&gt;=1.3.4; extra == "security" (from requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpqijb9gmg/plugin-example-0.0.1/wheels/requirements.txt (line 1))
Collecting pyOpenSSL&gt;=0.14; extra == "security" (from requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpqijb9gmg/plugin-example-0.0.1/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/01/c8/ceb170d81bd3941cbeb9940fc6cc2ef2ca4288d0ca8929ea4db5905d904d/pyOpenSSL-19.0.0-py2.py3-none-any.whl
Collecting six&gt;=1.4.1 (from cryptography&gt;=1.3.4; extra == "security"-&gt;requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpqijb9gmg/plugin-example-0.0.1/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/73/fb/00a976f728d0d1fecfe898238ce23f502a721c0ac0ecfedb80e0d88c64e9/six-1.12.0-py2.py3-none-any.whl
Collecting cffi!=1.11.3,&gt;=1.8 (from cryptography&gt;=1.3.4; extra == "security"-&gt;requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpqijb9gmg/plugin-example-0.0.1/wheels/requirements.txt (line 1))
Collecting asn1crypto&gt;=0.21.0 (from cryptography&gt;=1.3.4; extra == "security"-&gt;requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpqijb9gmg/plugin-example-0.0.1/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/ea/cd/35485615f45f30a510576f1a56d1e0a7ad7bd8ab5ed7cdc600ef7cd06222/asn1crypto-0.24.0-py2.py3-none-any.whl
Collecting pycparser (from cffi!=1.11.3,&gt;=1.8-&gt;cryptography&gt;=1.3.4; extra == "security"-&gt;requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpqijb9gmg/plugin-example-0.0.1/wheels/requirements.txt (line 1))
Installing collected packages: toml, chardet, urllib3, idna, certifi, six, pycparser, cffi, asn1crypto, cryptography, pyOpenSSL, requests, encapsia-api
Successfully installed asn1crypto-0.24.0 certifi-2019.6.16 cffi-1.12.3 chardet-3.0.4 cryptography-2.7 encapsia-api-0.1.21 idna-2.8 pyOpenSSL-19.0.0 pycparser-2.19 requests-2.22.0 six-1.12.0 toml-0.10.0 urllib3-1.25.3
Installing tasks in to namespace example
Installed task file /home/ice/example/test_module.py
Configuring 1 task workers for namespace example
Creating views namespace example
Created PostgreSQL schema: example
Installing views in to namespace example
Installing view permissions.sql
Installing view test_views.sql
Not publishing empty tags list.
Installing schedules in to namespace example
Installed plugin with id 648d5251729b4cb0ba2e0e4ca8a4d70e</span>
&gt;encapsia plugins --force uninstall example
<span class="ansi33">Uninstalling example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Status: ok</span>
<span class="ansi32">Downloaded blob bf15b485ca784763bae101e311c92f13 to /tmp/tmpl3q4nagn
Extracted /tmp/tmpl3q4nagn into /tmp/tmpp1_h3_n0
Role needs no update.
Destroying plugin namespace: example
Stopped all task workers for namespace: example
Destroyed virtualenv: example
Removed tasks directory: /home/ice/example
Removed webfiles directory: /var/share/nginx/iceplugins/example
Destroying views namespace example
Deleted PostgreSQL schema: example
Remove published permissions, if any
Remove published tags, if any
Removing all/any schedules from plugin namespace: example</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Create and destroy new namespace ===</span>
&gt;encapsia plugins dev-create-namespace testing123
<span class="ansi33">Creating namespace</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Status: ok</span>
<span class="ansi32">Made webfiles directory: /var/share/nginx/iceplugins/testing123
Made tasks directory: /home/ice/testing123
pew new -d testing123
Using base prefix '/home/ice/.pyenv/versions/3.6.7'
New python executable in /home/ice/.local/share/virtualenvs/testing123/bin/python3.6
Also creating executable in /home/ice/.local/share/virtualenvs/testing123/bin/python
Installing setuptools, pip, wheel...
done.
pew in testing123 pip install redis==2.10.6 rq==0.12.0
Collecting redis==2.10.6
  Using cached https://files.pythonhosted.org/packages/3b/f6/7a76333cf0b9251ecf49efff635015171843d9b977e4ffcf59f9c4428052/redis-2.10.6-py2.py3-none-any.whl
Collecting rq==0.12.0
  Using cached https://files.pythonhosted.org/packages/1d/3f/e05539962949aecd83496736f73abd36bd811884a20f68f691b59805125e/rq-0.12.0-py2.py3-none-any.whl
Collecting click&gt;=5.0 (from rq==0.12.0)
  Using cached https://files.pythonhosted.org/packages/fa/37/45185cb5abbc30d7257104c434fe0b07e5a195a6847506c074527aa599ec/Click-7.0-py2.py3-none-any.whl
Installing collected packages: redis, click, rq
Successfully installed click-7.0 redis-2.10.6 rq-0.12.0
Made virtualenv: testing123
Configuring 1 task workers for namespace testing123
Creating views namespace testing123
Created PostgreSQL schema: testing123</span>
&gt;encapsia plugins dev-destroy-namespace testing123
<span class="ansi33">Destroying namespace</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Status: ok</span>
<span class="ansi32">Stopped all task workers for namespace: testing123
Destroyed virtualenv: testing123
Removed tasks directory: /home/ice/testing123
Removed webfiles directory: /var/share/nginx/iceplugins/testing123
Destroying views namespace testing123
Deleted PostgreSQL schema: testing123</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Get info on all plugins ===</span>
&gt;encapsia plugins info
<span class="ansi33">name             version    description                     when                              plugin_tags
---------------  ---------  ------------------------------  --------------------------------  -------------
archiver         1.4.5.18   Web Archiver Plugin             2019-08-29T12:33:27.268949+00:00
conduct          1.5.5.15   Conduct app                     2019-08-29T12:34:30.342302+00:00
entry            1.7.2.15   Entry app                       2019-08-29T12:35:22.078022+00:00
esourcetraining  1.1.1.6    eSourceTraining app             2019-08-29T12:35:56.300078+00:00
inventory        1.0.1.11   Inventory app                   2019-08-29T12:36:33.819528+00:00
launch           1.2.3.4    Launch app                      2019-08-29T12:37:11.450151+00:00
loader           1.2.4.20   Web Loader Plugin               2019-08-29T12:37:51.265849+00:00
loaderreview     1.1.5.8    Review app                      2019-08-29T12:38:33.646682+00:00
manager          1.2.5.20   Manager app                     2019-08-29T12:39:11.348299+00:00
tags             1.1.2.7    Tags app                        2019-08-29T12:39:54.564410+00:00
tutor            1.1.3.9    Tutor app                       2019-08-29T12:40:23.279818+00:00
tutorbundles     1.1.0.4    Tutorbundles library for tutor  2019-08-29T12:40:55.735713+00:00</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Create a backup ===</span>
&gt;encapsia database backup /tmp/test_encapsia_backup
<span class="ansi33">Backing up database</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Downloaded 37776969 bytes to /tmp/test_encapsia_backup</span>
&gt;ls -l /tmp/test_encapsia_backup
-rw------- 1 tcorbettclark tcorbettclark 37776969 Aug 29 15:55 /tmp/test_encapsia_backup

<span class="ansi93"></span><span class="ansi1 ansi93">=== Restore from the backup ===</span>
&gt;encapsia database restore --yes /tmp/test_encapsia_backup
<span class="ansi33">Database restore requested.</span>
<span class="ansi33">Please verify by other means (e.g. look at the logs).</span>
&gt;sleep 5
&gt;rm /tmp/test_encapsia_backup

<span class="ansi93"></span><span class="ansi1 ansi93">=== Create a fixture ===</span>
&gt;encapsia fixtures create test_fixture
<span class="ansi33">Creating fixture test_fixture</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi32">Fixture "test_fixture" created on Thu Aug 29 15:55:29 2019</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Use a fixture ===</span>
&gt;encapsia fixtures use --yes test_fixture
<span class="ansi33">Requested change to fixture test_fixture.</span>
<span class="ansi33">Please verify by other means (e.g. look at the logs).</span>
&gt;sleep 5

<span class="ansi93"></span><span class="ansi1 ansi93">=== Delete a fixture ===</span>
&gt;encapsia fixtures delete --yes test_fixture
<span class="ansi33">Deleting fixture test_fixture</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi32">Deleted fixture: test_fixture</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== List all fixtures ===</span>
&gt;encapsia fixtures list
<span class="ansi33">Fetching list of fixtures</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi32">ready</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== (Setup for running views or tasks etc) Install the example plugin from src ===</span>
&gt;encapsia plugins --force dev-update $EXAMPLE_PLUGIN_SRC
<span class="ansi33">Including: tasks</span>
<span class="ansi33">Including: views</span>
<span class="ansi33">Including: wheels</span>
<span class="ansi33">Including: schedules</span>
<span class="ansi33">Uploading to server</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Status: ok</span>
<span class="ansi32">Extracted /tmp/ice/tmpcjoh422l into /tmp/tmpnd6t27f3
Installing plugin example (0.0.1)
Made webfiles directory: /var/share/nginx/iceplugins/example
Installing web files in to namespace example
Installed manifest /var/share/nginx/iceplugins/example/plugin.toml
pew new -d example
Using base prefix '/home/ice/.pyenv/versions/3.6.7'
New python executable in /home/ice/.local/share/virtualenvs/example/bin/python3.6
Also creating executable in /home/ice/.local/share/virtualenvs/example/bin/python
Installing setuptools, pip, wheel...
done.
pew in example pip install redis==2.10.6 rq==0.12.0
Collecting redis==2.10.6
  Using cached https://files.pythonhosted.org/packages/3b/f6/7a76333cf0b9251ecf49efff635015171843d9b977e4ffcf59f9c4428052/redis-2.10.6-py2.py3-none-any.whl
Collecting rq==0.12.0
  Using cached https://files.pythonhosted.org/packages/1d/3f/e05539962949aecd83496736f73abd36bd811884a20f68f691b59805125e/rq-0.12.0-py2.py3-none-any.whl
Collecting click&gt;=5.0 (from rq==0.12.0)
  Using cached https://files.pythonhosted.org/packages/fa/37/45185cb5abbc30d7257104c434fe0b07e5a195a6847506c074527aa599ec/Click-7.0-py2.py3-none-any.whl
Installing collected packages: redis, click, rq
Successfully installed click-7.0 redis-2.10.6 rq-0.12.0
Made virtualenv: example
Installing wheels in to namespace example
pew in example pip install --find-links /tmp/tmpnd6t27f3/tmpvz6wf1cw/wheels --requirement /tmp/tmpnd6t27f3/tmpvz6wf1cw/wheels/requirements.txt
Looking in links: /tmp/tmpnd6t27f3/tmpvz6wf1cw/wheels
Collecting encapsia-api (from -r /tmp/tmpnd6t27f3/tmpvz6wf1cw/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/d5/91/cb039693114295da784256bf070458997ff3aa2f52a6c3505df03a5bf4fc/encapsia_api-0.1.21-py3-none-any.whl
Collecting toml&lt;0.11.0,&gt;=0.10.0 (from encapsia-api-&gt;-r /tmp/tmpnd6t27f3/tmpvz6wf1cw/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/a2/12/ced7105d2de62fa7c8fb5fce92cc4ce66b57c95fb875e9318dba7f8c5db0/toml-0.10.0-py2.py3-none-any.whl
Collecting requests[security]&lt;3.0,&gt;=2.20 (from encapsia-api-&gt;-r /tmp/tmpnd6t27f3/tmpvz6wf1cw/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/51/bd/23c926cd341ea6b7dd0b2a00aba99ae0f828be89d72b2190f27c11d4b7fb/requests-2.22.0-py2.py3-none-any.whl
Collecting idna&lt;2.9,&gt;=2.5 (from requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpnd6t27f3/tmpvz6wf1cw/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/14/2c/cd551d81dbe15200be1cf41cd03869a46fe7226e7450af7a6545bfc474c9/idna-2.8-py2.py3-none-any.whl
Collecting urllib3!=1.25.0,!=1.25.1,&lt;1.26,&gt;=1.21.1 (from requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpnd6t27f3/tmpvz6wf1cw/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/e6/60/247f23a7121ae632d62811ba7f273d0e58972d75e58a94d329d51550a47d/urllib3-1.25.3-py2.py3-none-any.whl
Collecting chardet&lt;3.1.0,&gt;=3.0.2 (from requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpnd6t27f3/tmpvz6wf1cw/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/bc/a9/01ffebfb562e4274b6487b4bb1ddec7ca55ec7510b22e4c51f14098443b8/chardet-3.0.4-py2.py3-none-any.whl
Collecting certifi&gt;=2017.4.17 (from requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpnd6t27f3/tmpvz6wf1cw/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/69/1b/b853c7a9d4f6a6d00749e94eb6f3a041e342a885b87340b79c1ef73e3a78/certifi-2019.6.16-py2.py3-none-any.whl
Collecting pyOpenSSL&gt;=0.14; extra == "security" (from requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpnd6t27f3/tmpvz6wf1cw/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/01/c8/ceb170d81bd3941cbeb9940fc6cc2ef2ca4288d0ca8929ea4db5905d904d/pyOpenSSL-19.0.0-py2.py3-none-any.whl
Collecting cryptography&gt;=1.3.4; extra == "security" (from requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpnd6t27f3/tmpvz6wf1cw/wheels/requirements.txt (line 1))
Collecting six&gt;=1.5.2 (from pyOpenSSL&gt;=0.14; extra == "security"-&gt;requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpnd6t27f3/tmpvz6wf1cw/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/73/fb/00a976f728d0d1fecfe898238ce23f502a721c0ac0ecfedb80e0d88c64e9/six-1.12.0-py2.py3-none-any.whl
Collecting cffi!=1.11.3,&gt;=1.8 (from cryptography&gt;=1.3.4; extra == "security"-&gt;requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpnd6t27f3/tmpvz6wf1cw/wheels/requirements.txt (line 1))
Collecting asn1crypto&gt;=0.21.0 (from cryptography&gt;=1.3.4; extra == "security"-&gt;requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpnd6t27f3/tmpvz6wf1cw/wheels/requirements.txt (line 1))
  Using cached https://files.pythonhosted.org/packages/ea/cd/35485615f45f30a510576f1a56d1e0a7ad7bd8ab5ed7cdc600ef7cd06222/asn1crypto-0.24.0-py2.py3-none-any.whl
Collecting pycparser (from cffi!=1.11.3,&gt;=1.8-&gt;cryptography&gt;=1.3.4; extra == "security"-&gt;requests[security]&lt;3.0,&gt;=2.20-&gt;encapsia-api-&gt;-r /tmp/tmpnd6t27f3/tmpvz6wf1cw/wheels/requirements.txt (line 1))
Installing collected packages: toml, idna, urllib3, chardet, certifi, six, pycparser, cffi, asn1crypto, cryptography, pyOpenSSL, requests, encapsia-api
Successfully installed asn1crypto-0.24.0 certifi-2019.6.16 cffi-1.12.3 chardet-3.0.4 cryptography-2.7 encapsia-api-0.1.21 idna-2.8 pyOpenSSL-19.0.0 pycparser-2.19 requests-2.22.0 six-1.12.0 toml-0.10.0 urllib3-1.25.3
Installing tasks in to namespace example
Installed task file /home/ice/example/test_module.py
Configuring 1 task workers for namespace example
Creating views namespace example
Created PostgreSQL schema: example
Installing views in to namespace example
Installing view permissions.sql
Installing view test_views.sql
Not publishing empty tags list.
Installing schedules in to namespace example</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run view with no arguments ===</span>
&gt;encapsia run view example test_no_args
<span class="ansi32">[
    {
        "answer": "function with no arguments"
    }
]</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run view and save result to file ===</span>
&gt;encapsia run view example test_no_args --save-as /tmp/encapsia_test_save_from_view.txt
<span class="ansi33">Response saved to: /tmp/encapsia_test_save_from_view.txt (mime_type=application/json)</span>
&gt;echo $(cat /tmp/encapsia_test_save_from_view.txt)
[{"answer": "function with no arguments"}]
&gt;rm /tmp/encapsia_test_save_from_view.txt

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run view with one argument ===</span>
&gt;encapsia run view example test_one_arg hello
<span class="ansi32">[
    {
        "argument": "hello"
    }
]</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run view with two arguments ===</span>
&gt;encapsia run view example test_two_args "hello" " world"
<span class="ansi32">[
    {
        "test_two_args": "hello world"
    }
]</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run view with no arguments to return meta ===</span>
&gt;encapsia run view example test_only_meta
<span class="ansi32">[
    {
        "test_only_meta": {
            "capabilities": [
                "superuser"
            ],
            "contact_address": null,
            "contact_emails": null,
            "device": null,
            "email": "tcorbettclark@cmedtechnology.com",
            "enabled": true,
            "expires_at": "2020-08-28T15:52:50.473495+00:00",
            "first_name": "Timothy",
            "id": 86,
            "is_site_user": false,
            "issued_at": "2019-08-29T15:52:50.473495+00:00",
            "last_name": "Corbett-Clark",
            "name": "Timothy Corbett-Clark",
            "namespace": "example",
            "notification_token": null,
            "phone_number": null,
            "role": "Superuser",
            "role_alias": "Superuser",
            "site": null,
            "site_id": null,
            "sites": null,
            "token": "dfce4d249a154c65bf3ae7b9f57acb0c",
            "url": "https://dawn.icethree.com/v1/views/example/test_only_meta"
        }
    }
]</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run view with one optional argument ===</span>
&gt;encapsia run view example test_one_optional_arg
<span class="ansi32">[
    {
        "test_one_optional_arg": 1000
    }
]</span>
&gt;encapsia run view example test_one_optional_arg limit=999
<span class="ansi32">[
    {
        "test_one_optional_arg": 999
    }
]</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run view with mixture of argument types ===</span>
&gt;encapsia run view example test_mixture hello limit=123
<span class="ansi32">[
    {
        "test_mixture": {
            "arg1": "hello",
            "limit": 123,
            "meta": {
                "capabilities": [
                    "superuser"
                ],
                "contact_address": null,
                "contact_emails": null,
                "device": null,
                "email": "tcorbettclark@cmedtechnology.com",
                "enabled": true,
                "expires_at": "2020-08-28T15:52:50.473495+00:00",
                "first_name": "Timothy",
                "id": 86,
                "is_site_user": false,
                "issued_at": "2019-08-29T15:52:50.473495+00:00",
                "last_name": "Corbett-Clark",
                "name": "Timothy Corbett-Clark",
                "namespace": "example",
                "notification_token": null,
                "phone_number": null,
                "role": "Superuser",
                "role_alias": "Superuser",
                "site": null,
                "site_id": null,
                "sites": null,
                "token": "dfce4d249a154c65bf3ae7b9f57acb0c",
                "url": "https://dawn.icethree.com/v1/views/example/test_mixture/hello?limit=123"
            }
        }
    }
]</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run view which returns CSV directly ===</span>
&gt;encapsia run view --post example example_view_function_as_csv_file
<span class="ansi32">"x,y\n\"1\",\"2\"\n\"3\",\"4\"\n"</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run view which populates table from CSV file ===</span>
&gt;encapsia run view --post example example_create_and_populate_table --upload treaties.csv
<span class="ansi32">[
    {
        "n_records": 4
    }
]</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run view and use save as ===</span>
&gt;encapsia run view example test_one_optional_arg --save-as=/tmp/test_view_download.json
<span class="ansi33">Response saved to: /tmp/test_view_download.json (mime_type=application/json)</span>
&gt;echo -n '[{"test_one_optional_arg": 1000}]'
&gt;diff -s /tmp/test_view_download.json -
Files /tmp/test_view_download.json and - are identical
&gt;rm /tmp/test_view_download.json

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run view which returns CSV directly and use save as ===</span>
&gt;encapsia run view --post example example_view_function_as_csv_file --save-as=/tmp/test_view_download.csv
<span class="ansi33">Response saved to: /tmp/test_view_download.csv (mime_type=text/csv)</span>
&gt;cat /tmp/test_view_download.csv
x,y
"1","2"
"3","4"
&gt;rm /tmp/test_view_download.csv

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run basic test task function ===</span>
&gt;encapsia run task example test_module.test_function name=tim
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi32">"hello tim"</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run basic test task function and save result to file ===</span>
&gt;encapsia run task example test_module.test_function --save-as /tmp/encapsia_test_save_from_task.txt name=tim
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Response saved to: /tmp/encapsia_test_save_from_task.txt (mime_type=application/json)</span>
&gt;echo $(cat /tmp/encapsia_test_save_from_task.txt)
"hello tim"
&gt;rm /tmp/encapsia_test_save_from_task.txt

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run basic test task function with blank argument ===</span>
&gt;encapsia run task example test_module.test_function name=
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi32">"hello "</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run test task function written with fixed arguments ===</span>
&gt;encapsia run task example test_module.test_function_with_fixed_args name=tim
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi32">"hello tim"</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run test task function accepting any arguments ===</span>
&gt;encapsia run task example test_module.test_function_with_any_args a=1 b=2 c=3
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi32">{
    "a": "1",
    "b": "2",
    "c": "3",
    "meta": {
        "capabilities": [
            "superuser"
        ],
        "contact_address": null,
        "contact_emails": null,
        "device": null,
        "email": "tcorbettclark@cmedtechnology.com",
        "enabled": true,
        "expires_at": "2019-08-29T16:06:16.875398+00:00",
        "first_name": "Timothy",
        "id": 86,
        "is_site_user": false,
        "issued_at": "2019-08-29T15:56:16.875398+00:00",
        "last_name": "Corbett-Clark",
        "name": "Timothy Corbett-Clark",
        "namespace": "example",
        "notification_token": null,
        "phone_number": null,
        "role": "Superuser",
        "role_alias": "Superuser",
        "site": null,
        "site_id": null,
        "sites": null,
        "token": "93cd05d616b44e629f268b3f910a46cb",
        "url": "https://dawn.icethree.com/v1/tasks/example/test_module.test_function_with_any_args?a=1&amp;b=2&amp;c=3"
    }
}</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run test task function which only takes meta as a fixed argument ===</span>
&gt;encapsia run task example test_module.test_function_with_meta_as_fixed_arg
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi32">{
    "capabilities": [
        "superuser"
    ],
    "contact_address": null,
    "contact_emails": null,
    "device": null,
    "email": "tcorbettclark@cmedtechnology.com",
    "enabled": true,
    "expires_at": "2019-08-29T16:06:18.300690+00:00",
    "first_name": "Timothy",
    "id": 86,
    "is_site_user": false,
    "issued_at": "2019-08-29T15:56:18.300690+00:00",
    "last_name": "Corbett-Clark",
    "name": "Timothy Corbett-Clark",
    "namespace": "example",
    "notification_token": null,
    "phone_number": null,
    "role": "Superuser",
    "role_alias": "Superuser",
    "site": null,
    "site_id": null,
    "sites": null,
    "token": "2e0d8b1e78394d98922771d69c5f8e90",
    "url": "https://dawn.icethree.com/v1/tasks/example/test_module.test_function_with_meta_as_fixed_arg"
}</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run task function with uploaded text data. ===</span>
&gt;encapsia run task example test_module.test_function_for_posted_data --upload=example_data.txt
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi32">"I've been uploaded from a file!"</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run task function with uploaded json data. ===</span>
&gt;encapsia run task example test_module.test_function_for_posted_data --upload=example_data.json
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi32">{
    "name": "Father Christmas"
}</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run task function with uploaded jpg data. ===</span>
&gt;encapsia run task example test_module.test_function_for_posted_data --upload=example_data.jpg
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi32">"\u042a\u044c\u042a\u0448\u0000C\u0000\u0003\u0002\u0002\u0002\u0002\u0002\u0003\u0002\u0002\u0002\u0003\u0003\u0003\u0003\u0004\u0006\u0004\u0004\u0004\u0004\u0004\b\u0006\u0006\u0005\u0006\t\b\n\n\t\b\t\t\n\f\u000f\f\n\u000b\u000e\u000b\t\t\r\u0011\r\u000e\u000f\u0010\u0010\u0011\u0010\n\f\u0012\u0013\u0012\u0010\u0013\u000f\u0010\u0010\u0010\u042a\u0438\u0000\u000b\b\u0000\u0001\u0000\u0001\u0001\u0001\u0011\u0000\u042a\u043b\u0000\u0006\u0000\u0010\u0010\u0005\u042a\u0437\u0000\b\u0001\u0001\u0000\u0000?\u0000\u0440\u043e \u042a\u044b"</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run task function with uploaded json data. ===</span>
&gt;encapsia run task example test_module.test_function_for_posted_data --upload=example_data.json
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi32">{
    "name": "Father Christmas"
}</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run task function with uploaded jpg data. ===</span>
&gt;encapsia run task example test_module.test_function_for_posted_data --upload=example_data.jpg
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi32">"\u042a\u044c\u042a\u0448\u0000C\u0000\u0003\u0002\u0002\u0002\u0002\u0002\u0003\u0002\u0002\u0002\u0003\u0003\u0003\u0003\u0004\u0006\u0004\u0004\u0004\u0004\u0004\b\u0006\u0006\u0005\u0006\t\b\n\n\t\b\t\t\n\f\u000f\f\n\u000b\u000e\u000b\t\t\r\u0011\r\u000e\u000f\u0010\u0010\u0011\u0010\n\f\u0012\u0013\u0012\u0010\u0013\u000f\u0010\u0010\u0010\u042a\u0438\u0000\u000b\b\u0000\u0001\u0000\u0001\u0001\u0001\u0011\u0000\u042a\u043b\u0000\u0006\u0000\u0010\u0010\u0005\u042a\u0437\u0000\b\u0001\u0001\u0000\u0000?\u0000\u0440\u043e \u042a\u044b"</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run task function with uploaded text data and use save as. ===</span>
&gt;encapsia run task example test_module.test_function_for_posted_data --upload=example_data.txt --save-as=/tmp/example_data.txt
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Response saved to: /tmp/example_data.txt (mime_type=application/json)</span>
&gt;echo -n "\"$(cat example_data.txt)\""
&gt;diff -s /tmp/example_data.txt -
Files /tmp/example_data.txt and - are identical
&gt;rm /tmp/example_data.txt

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run task function with uploaded json data and use save as. ===</span>
&gt;encapsia run task example test_module.test_function_for_posted_data --upload=example_data.json --save-as=/tmp/example_data.json
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Response saved to: /tmp/example_data.json (mime_type=application/json)</span>
&gt;diff -s example_data.json /tmp/example_data.json
Files example_data.json and /tmp/example_data.json are identical
&gt;rm /tmp/example_data.json

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run task function with uploaded jpg data and use save as. ===</span>
&gt;encapsia run task example test_module.test_function_for_posted_data --upload=example_data.jpg --save-as=/tmp/example_data.jpg
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Response saved to: /tmp/example_data.jpg (mime_type=image/jpeg)</span>
&gt;diff -s example_data.jpg /tmp/example_data.jpg
Files example_data.jpg and /tmp/example_data.jpg are identical
&gt;rm /tmp/example_data.jpg

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run task function which takes no arguments. This *should* fail!!! ===</span>
&gt;encapsia run task example test_module.test_function_with_no_args
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi31">
Status: failed</span>
<span class="ansi31">Traceback (most recent call last):
  File "/home/ice/.local/share/virtualenvs/example/lib/python3.6/site-packages/rq/worker.py", line 793, in perform_job
    rv = job.perform()
  File "/home/ice/.local/share/virtualenvs/example/lib/python3.6/site-packages/rq/job.py", line 599, in perform
    self._result = self._execute()
  File "/home/ice/.local/share/virtualenvs/example/lib/python3.6/site-packages/rq/job.py", line 605, in _execute
    return self.func(*self.args, **self.kwargs)
TypeError: test_function_with_no_args() got an unexpected keyword argument 'meta'
</span>
Aborted!
&gt;true

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run task function with fixed arg and no meta. This *should* fail!!! ===</span>
&gt;encapsia run task example test_module.test_function_with_single_arg_and_no_meta name=tim
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi31">
Status: failed</span>
<span class="ansi31">Traceback (most recent call last):
  File "/home/ice/.local/share/virtualenvs/example/lib/python3.6/site-packages/rq/worker.py", line 793, in perform_job
    rv = job.perform()
  File "/home/ice/.local/share/virtualenvs/example/lib/python3.6/site-packages/rq/job.py", line 599, in perform
    self._result = self._execute()
  File "/home/ice/.local/share/virtualenvs/example/lib/python3.6/site-packages/rq/job.py", line 605, in _execute
    return self.func(*self.args, **self.kwargs)
TypeError: test_function_with_single_arg_and_no_meta() got an unexpected keyword argument 'meta'
</span>
Aborted!
&gt;true

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run task function with arg and no meta. This *should* fail!!! ===</span>
&gt;encapsia run task example test_module.test_function_with_single_kwarg name=tim
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi31">
Status: failed</span>
<span class="ansi31">Traceback (most recent call last):
  File "/home/ice/.local/share/virtualenvs/example/lib/python3.6/site-packages/rq/worker.py", line 793, in perform_job
    rv = job.perform()
  File "/home/ice/.local/share/virtualenvs/example/lib/python3.6/site-packages/rq/job.py", line 599, in perform
    self._result = self._execute()
  File "/home/ice/.local/share/virtualenvs/example/lib/python3.6/site-packages/rq/job.py", line 605, in _execute
    return self.func(*self.args, **self.kwargs)
TypeError: test_function_with_single_kwarg() got an unexpected keyword argument 'meta'
</span>
Aborted!
&gt;true

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run task function expecting uploaded data but without any data. This *should* fail!!! ===</span>
&gt;encapsia run task example test_module.test_function_for_posted_data
<span class="ansi33">Running task example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi31">
Status: failed</span>
<span class="ansi31">Traceback (most recent call last):
  File "/home/ice/.local/share/virtualenvs/example/lib/python3.6/site-packages/rq/worker.py", line 793, in perform_job
    rv = job.perform()
  File "/home/ice/.local/share/virtualenvs/example/lib/python3.6/site-packages/rq/job.py", line 599, in perform
    self._result = self._execute()
  File "/home/ice/.local/share/virtualenvs/example/lib/python3.6/site-packages/rq/job.py", line 605, in _execute
    return self.func(*self.args, **self.kwargs)
  File "./test_module.py", line 70, in test_function_for_posted_data
    with open(posted_data_filename, "rb") as f_read:
TypeError: expected str, bytes or os.PathLike object, not NoneType
</span>
Aborted!
&gt;true

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run job function and return (JSON) result ===</span>
&gt;encapsia run job example test_module.test_function_for_a_job name=Tim
<span class="ansi33">Running job example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi32">"Hello Tim"</span>

<span class="ansi93"></span><span class="ansi1 ansi93">=== Run job function and save (JSON) result ===</span>
&gt;encapsia run job example test_module.test_function_for_a_job name=Tim --save-as=/tmp/test_job_result.json
<span class="ansi33">Running job example</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">.</span><span class="ansi33">Done</span>
<span class="ansi33">Response saved to: /tmp/test_job_result.json (mime_type=application/json)</span>
&gt;echo $(cat /tmp/test_job_result.json)
"Hello Tim"
&gt;rm /tmp/test_job_result.json

</pre>
</body>

</html>
